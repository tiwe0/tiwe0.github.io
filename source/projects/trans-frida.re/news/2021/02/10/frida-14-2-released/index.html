<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Jekyll v4.2.0">
  <link type="application/atom+xml" rel="alternate" href="../../../../../feed.xml" title="Frida • A world-class dynamic instrumentation toolkit" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Frida’s master branch" href="https://github.com/frida/frida/commits/master.atom" />
  <link rel="stylesheet" href="../../../../../css/screen.css" />
  <link rel="icon" type="image/png" href="../../../../../favicon.ico" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Frida 14.2 Released | Frida • A world-class dynamic instrumentation toolkit</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Frida 14.2 Released" />
<meta name="author" content="oleavr" />
<meta property="og:locale" content="en" />
<meta name="description" content="Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX" />
<meta property="og:description" content="Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX" />
<link rel="canonical" href="index.html" />
<meta property="og:url" content="https://frida.re/news/2021/02/10/frida-14-2-released/" />
<meta property="og:site_name" content="Frida • A world-class dynamic instrumentation toolkit" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-10T09:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Frida 14.2 Released" />
<meta name="twitter:site" content="@fridadotre" />
<meta name="twitter:creator" content="@oleavr" />
<script type="application/ld+json">
{"headline":"Frida 14.2 Released","dateModified":"2021-02-10T09:00:00+01:00","datePublished":"2021-02-10T09:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://frida.re/news/2021/02/10/frida-14-2-released/"},"author":{"@type":"Person","name":"oleavr"},"@type":"BlogPosting","description":"Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX","url":"https://frida.re/news/2021/02/10/frida-14-2-released/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <script src="../../../../../js/modernizr-2.5.3.min.js"></script>
</head>


<body class="wrap">
  <header>
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="../../../../../index.html">Overview</a>
  </li>
  <li class="">
    <a href="../../../../../docs/home/index.html">Docs</span></a>
  </li>
  <li class="current">
    <a href="../../../../index.html">News</a>
  </li>
  <li class="">
    <a href="https://github.com/frida/frida">Code</a>
  </li>
  <li class="">
    <a href="../../../../../contact/index.html">Contact</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="logotype unit one-third center-on-mobiles">
      <a href="../../../../../index.html">
        <span>FЯIDA</span>
        <img src="../../../../../img/logotype.svg" width="205" height="39" alt="">
      </a>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="../../../../../index.html">Overview</a>
  </li>
  <li class="">
    <a href="../../../../../docs/home/index.html">Docs</span></a>
  </li>
  <li class="current">
    <a href="../../../../index.html">News</a>
  </li>
  <li class="">
    <a href="https://github.com/frida/frida">Code</a>
  </li>
  <li class="">
    <a href="../../../../../contact/index.html">Contact</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="news">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the blog…</option>
    <option value="/news/">Home</option>
    <optgroup label="v1.x">
      
      <option value="/news/2023/12/24/frida-16-1-10-released/">Frida 16.1.10 Released</option>
      
      <option value="/news/2023/12/20/frida-16-1-9-released/">Frida 16.1.9 Released</option>
      
      <option value="/news/2023/11/28/frida-16-1-8-released/">Frida 16.1.8 Released</option>
      
      <option value="/news/2023/11/16/frida-16-1-7-released/">Frida 16.1.7 Released</option>
      
      <option value="/news/2023/11/13/frida-16-1-6-released/">Frida 16.1.6 Released</option>
      
      <option value="/news/2023/11/04/frida-16-1-5-released/">Frida 16.1.5 Released</option>
      
      <option value="/news/2023/08/29/frida-16-1-4-released/">Frida 16.1.4 Released</option>
      
      <option value="/news/2023/07/14/frida-16-1-3-released/">Frida 16.1.3 Released</option>
      
      <option value="/news/2023/07/11/frida-16-1-2-released/">Frida 16.1.2 Released</option>
      
      <option value="/news/2023/07/01/frida-16-1-1-released/">Frida 16.1.1 Released</option>
      
      <option value="/news/2023/06/23/frida-16-1-0-released/">Frida 16.1.0 Released</option>
      
      <option value="/news/2023/04/27/frida-16-0-19-released/">Frida 16.0.19 Released</option>
      
      <option value="/news/2023/04/22/frida-16-0-18-released/">Frida 16.0.18 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-17-released/">Frida 16.0.17 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-16-released/">Frida 16.0.16 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-15-released/">Frida 16.0.15 Released</option>
      
      <option value="/news/2023/04/18/frida-16-0-14-released/">Frida 16.0.14 Released</option>
      
      <option value="/news/2023/04/15/frida-16-0-13-released/">Frida 16.0.13 Released</option>
      
      <option value="/news/2023/04/14/frida-16-0-12-released/">Frida 16.0.12 Released</option>
      
      <option value="/news/2023/03/10/frida-16-0-11-released/">Frida 16.0.11 Released</option>
      
      <option value="/news/2023/02/17/frida-16-0-10-released/">Frida 16.0.10 Released</option>
      
      <option value="/news/2023/02/11/frida-16-0-9-released/">Frida 16.0.9 Released</option>
      
      <option value="/news/2022/12/13/frida-16-0-8-released/">Frida 16.0.8 Released</option>
      
      <option value="/news/2022/12/02/frida-16-0-7-released/">Frida 16.0.7 Released</option>
      
      <option value="/news/2022/12/01/frida-16-0-6-released/">Frida 16.0.6 Released</option>
      
      <option value="/news/2022/11/28/frida-16-0-5-released/">Frida 16.0.5 Released</option>
      
      <option value="/news/2022/11/26/frida-16-0-4-released/">Frida 16.0.4 Released</option>
      
      <option value="/news/2022/11/23/frida-16-0-3-released/">Frida 16.0.3 Released</option>
      
      <option value="/news/2022/10/22/frida-16-0-2-released/">Frida 16.0.2 Released</option>
      
      <option value="/news/2022/10/08/frida-16-0-1-released/">Frida 16.0.1 Released</option>
      
      <option value="/news/2022/10/08/frida-16-0-0-released/">Frida 16.0.0 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-2-released/">Frida 15.2.2 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-1-released/">Frida 15.2.1 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-0-released/">Frida 15.2.0 Released</option>
      
      <option value="/news/2022/07/06/frida-15-1-28-released/">Frida 15.1.28 Released</option>
      
      <option value="/news/2022/06/20/frida-15-1-27-released/">Frida 15.1.27 Released</option>
      
      <option value="/news/2022/06/20/frida-15-1-26-released/">Frida 15.1.26 Released</option>
      
      <option value="/news/2022/06/18/frida-15-1-25-released/">Frida 15.1.25 Released</option>
      
      <option value="/news/2022/06/03/frida-15-1-24-released/">Frida 15.1.24 Released</option>
      
      <option value="/news/2022/05/30/frida-15-1-23-released/">Frida 15.1.23 Released</option>
      
      <option value="/news/2022/05/09/frida-15-1-22-released/">Frida 15.1.22 Released</option>
      
      <option value="/news/2022/05/06/frida-15-1-21-released/">Frida 15.1.21 Released</option>
      
      <option value="/news/2022/05/06/frida-15-1-20-released/">Frida 15.1.20 Released</option>
      
      <option value="/news/2022/05/04/frida-15-1-19-released/">Frida 15.1.19 Released</option>
      
      <option value="/news/2022/05/04/frida-15-1-18-released/">Frida 15.1.18 Released</option>
      
      <option value="/news/2022/02/10/frida-15-1-17-released/">Frida 15.1.17 Released</option>
      
      <option value="/news/2022/02/03/frida-15-1-16-released/">Frida 15.1.16 Released</option>
      
      <option value="/news/2022/02/01/frida-15-1-15-released/">Frida 15.1.15 Released</option>
      
      <option value="/news/2021/09/03/frida-15-1-released/">Frida 15.1 Released</option>
      
      <option value="/news/2021/07/18/frida-15-0-released/">Frida 15.0 Released</option>
      
      <option value="/news/2021/02/10/frida-14-2-released/">Frida 14.2 Released</option>
      
      <option value="/news/2020/12/01/frida-14-1-released/">Frida 14.1 Released</option>
      
      <option value="/news/2020/10/28/frida-14-0-released/">Frida 14.0 Released</option>
      
      <option value="/news/2020/07/24/frida-12-11-released/">Frida 12.11 Released</option>
      
      <option value="/news/2020/06/29/frida-12-10-released/">Frida 12.10 Released</option>
      
      <option value="/news/2020/05/19/frida-12-9-released/">Frida 12.9 Released</option>
      
      <option value="/news/2019/12/18/frida-12-8-released/">Frida 12.8 Released</option>
      
      <option value="/news/2019/09/18/frida-12-7-released/">Frida 12.7 Released</option>
      
      <option value="/news/2019/05/28/frida-12-6-released/">Frida 12.6 Released</option>
      
      <option value="/news/2019/05/15/nowsecure-connect-2019/">NowSecure Connect 2019</option>
      
      <option value="/news/2019/05/15/frida-12-5-released/">Frida 12.5 Released</option>
      
      <option value="/news/2018/09/11/frida-12-2-released/">Frida 12.2 Released</option>
      
      <option value="/news/2018/08/25/frida-12-1-released/">Frida 12.1 Released</option>
      
      <option value="/news/2018/07/12/frida-12-0-released/">Frida 12.0 Released</option>
      
      <option value="/news/2018/05/05/frida-11-0-released/">Frida 11.0 Released</option>
      
      <option value="/news/2018/04/28/frida-10-8-released/">Frida 10.8 Released</option>
      
      <option value="/news/2018/03/13/frida-10-7-released/">Frida 10.7 Released</option>
      
      <option value="/news/2017/09/29/frida-10-6-released/">Frida 10.6 Released</option>
      
      <option value="/news/2017/08/25/frida-10-5-released/">Frida 10.5 Released</option>
      
      <option value="/news/2017/08/15/frida-10-4-released/">Frida 10.4 Released</option>
      
      <option value="/news/2017/05/02/frida-10-0-released/">Frida 10.0 Released</option>
      
      <option value="/news/2017/01/09/frida-9-0-released/">Frida 9.0 Released</option>
      
      <option value="/news/2016/10/25/frida-8-1-released/">Frida 8.1 Released</option>
      
      <option value="/news/2016/10/04/frida-8-0-released/">Frida 8.0 Released</option>
      
      <option value="/news/2016/08/15/frida-7-3-released/">Frida 7.3 Released</option>
      
      <option value="/news/2016/06/02/frida-7-2-released/">Frida 7.2 Released</option>
      
      <option value="/news/2016/04/04/frida-7-1-released/">Frida 7.1 Released</option>
      
      <option value="/news/2016/02/24/frida-7-0-released/">Frida 7.0 Released</option>
      
      <option value="/news/2016/02/01/frida-6-2-released/">Frida 6.2 Released</option>
      
      <option value="/news/2016/01/31/frida-fosdem-presentation/">Frida presentation at FOSDEM 2016</option>
      
      <option value="/news/2016/01/14/frida-6-1-released/">Frida 6.1 Released</option>
      
      <option value="/news/2015/11/11/frida-6-0-released/">Frida 6.0 Released</option>
      
      <option value="/news/2015/09/17/frida-5-0-released/">Frida 5.0 Released</option>
      
      <option value="/news/2015/09/10/frida-4-5-released/">Frida 4.5 Released</option>
      
      <option value="/news/2015/07/31/frida-4-4-released/">Frida 4.4 Released</option>
      
      <option value="/news/2015/07/15/frida-4-3-released/">Frida 4.3 Released</option>
      
      <option value="/news/2015/06/18/frida-4-2-released/">Frida 4.2 Released</option>
      
      <option value="/news/2015/06/09/frida-4-1-released/">Frida 4.1 Released</option>
      
      <option value="/news/2015/05/09/frida-4-0-0-released/">Frida 4.0.0 Released</option>
      
      <option value="/news/2015/03/20/frida-3-0-0-released/">Frida 3.0.0 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-2-released/">Frida 2.0.2 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-1-released/">Frida 2.0.1 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-0-released/">Frida 2.0.0 Released</option>
      
      <option value="/news/2015/02/23/frida-1-8-0-released/">Frida 1.8.0 Released</option>
      
      <option value="/news/2014/11/18/frida-1-6-8-released/">Frida 1.6.8 Released</option>
      
      <option value="/news/2014/11/03/frida-1-6-7-released/">Frida 1.6.7 Released</option>
      
      <option value="/news/2014/11/03/frida-1-6-6-released/">Frida 1.6.6 Released</option>
      
      <option value="/news/2014/10/29/frida-1-6-5-released/">Frida 1.6.5 Released</option>
      
      <option value="/news/2014/10/19/frida-1-6-4-released/">Frida 1.6.4 Released</option>
      
      <option value="/news/2014/08/25/frida-1-6-3-released/">Frida 1.6.3 Released</option>
      
      <option value="/news/2014/08/03/frida-1-6-2-released/">Frida 1.6.2 Released</option>
      
      <option value="/news/2014/07/26/frida-1-6-1-released/">Frida 1.6.1 Released</option>
      
      <option value="/news/2014/05/30/frida-1-6-0-released/">Frida 1.6.0 Released</option>
      
      <option value="/news/2014/05/14/frida-1-4-2-released/">Frida 1.4.2 Released</option>
      
      <option value="/news/2014/05/14/frida-1-4-1-released/">Frida 1.4.1 Released</option>
      
      <option value="/news/2014/05/04/frida-1-4-0-released/">Frida 1.4.0 Released</option>
      
      <option value="/news/2014/04/21/frida-1-2-1-released/">Frida 1.2.1 Released</option>
      
      <option value="/news/2014/04/17/frida-1-2-0-released/">Frida 1.2.0 Released</option>
      
      <option value="/news/2014/03/09/frida-1-0-11-released/">Frida 1.0.11 Released</option>
      
      <option value="/news/2014/02/16/frida-1-0-10-released/">Frida 1.0.10 Released</option>
      
      <option value="/news/2014/01/25/frida-1-0-9-released/">Frida 1.0.9 Released</option>
      
      <option value="/news/2014/01/15/frida-1-0-8-released/">Frida 1.0.8 Released</option>
      
      <option value="/news/2014/01/12/frida-1-0-7-released/">Frida 1.0.7 Released</option>
      
      <option value="/news/2014/01/11/frida-1-0-6-released/">Frida 1.0.6 Released</option>
      
      <option value="/news/2014/01/05/frida-1-0-5-released/">Frida 1.0.5 Released</option>
      
    </optgroup>
  </select>
</div>

      <div class="news-nav-desktop unit one-quarter hide-on-mobiles">
  <aside>
    <ul>
      <li class="">
        <a href="../../../../index.html">All News</a>
      </li>
      <li class="">
        <a href="../../../../releases/index.html">Frida Releases</a>
      </li>
    </ul>
    <h4>Recent Releases</h4>
    <ul>
      
      <li class="">
        <a href="../../../../2023/12/24/frida-16-1-10-released/index.html">Version 16.1.10</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/12/20/frida-16-1-9-released/index.html">Version 16.1.9</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/28/frida-16-1-8-released/index.html">Version 16.1.8</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/16/frida-16-1-7-released/index.html">Version 16.1.7</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/13/frida-16-1-6-released/index.html">Version 16.1.6</a>
      </li>
      
      <li>
        <a href="../../../../../docs/history/index.html">History »</a>
      </li>
    </ul>
    <h4>Other News</h4>
    <ul>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="">
          <a href="../../../../2019/05/15/nowsecure-connect-2019/index.html">NowSecure Connect 2019</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="">
          <a href="../../../../2016/01/31/frida-fosdem-presentation/index.html">Frida presentation at FOSDEM 2016</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </ul>
  </aside>
</div>


      <div class="news-articles unit three-quarters">
        <article>
  <h2>
    Frida 14.2 Released
    <a href="index.html" class="permalink" title="Permalink">∞</a>
  </h2>
  <span class="post-category">
    
    <span class="label">release</span>
    
  </span>
  <div class="post-meta">
    <span class="post-date">
      10 Feb 2021
    </span>
    <a href="https://github.com/oleavr" class="post-author">
      <img src="https://github.com/oleavr.png" class="avatar" />
      oleavr
    </a>
  </div>
  <p class="post-content">
    <p>So much to talk about. Let’s kick things off with a big new feature:</p>

<h2 id="realms">Realms</h2>

<p>Frida has supported Android for quite a while, but one particular feature has
kept getting requested (mostly) by users who thought they were looking at a bug.
The conversation usually started something like: “I’m using Frida inside the
hardware-accelerated Android emulator X, and when I attach to this process Y,
Process.enumerateModules() is missing JNI library Z. But I can see it in
Process.enumerateRanges() and /proc/$pid/maps. How come?”</p>

<p>As you may have guessed, we’re talking about Android’s NativeBridge, typically
used on Intel-powered Android devices to enable them to run apps that only
support ARM – i.e. apps with one or more JNI components only built for ARM.</p>

<p>In a Frida context, however, we’re usually talking about a VirtualBox-based
emulator that runs an Android system built for x86. This system then ships with
NativeBridge support powered by libhoudini, a proprietary ARM translator.</p>

<p>There’s quite a few of these emulators, e.g. BlueStacks, LDPlayer, NoxPlayer,
etc. While the ones mentioned are optimized for running games, there’s now also
Google’s official Android 11 AVDs which ship with NativeBridge support out of
the gate.</p>

<p>Through the years I’ve been thinking about how we could support such scenarios
in Frida, but thinking about it always made my head hurt a little. It did feel
like something we should support at some point, though, I just had a hard time
figuring out what the API would look like.</p>

<p>Then along came 2020 and Apple announced their transition to ARM, and suddenly
Rosetta became relevant once again. “Alright”, I thought, “now we have two
platforms where it would be useful to support processes containing an emulated
realm that’s running legacy code.”</p>

<p>And yeah there’s also Windows, but we don’t yet support Windows on ARM. We
totally should though, so if somebody’s interested in taking a stab at this
then please <em>do</em> get in touch.</p>

<p>Anyway, I’m exited to announce that our Android binaries for x86 and x86_64
now support such processes out of the box. You may already be familiar with
the following frida-core API, where the Python flavor looks like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">session</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code></pre></figure>

<p>(Or <em>frida.attach()</em> if your code only deals with the local system.)</p>

<p>If <em>target</em> has an emulated realm, you can now do:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">session</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">realm</span><span class="o">=</span><span class="s">'emulated'</span><span class="p">)</span></code></pre></figure>

<p>The default is <code class="language-plaintext highlighter-rouge">realm='native'</code>, and you can actually use both realms at the
same time. And when using our CLI tools, pass <code class="language-plaintext highlighter-rouge">--realm=emulated</code> to act on the
emulated realm.</p>

<p>One important caveat when using this on Android is that you will need to apply
your Java-level instrumentation in the <em>native</em> realm.</p>

<p>Lastly it’s worth noting that this new feature is only supported on Android for
now, but it shouldn’t be hard to support Rosetta on macOS down the road.
Definitely get in touch if you want to help out with this.</p>

<h2 id="taking-android-java-hooking-inline">Taking Android Java Hooking Inline</h2>

<p>The way Frida’s <a href="https://github.com/frida/frida-java-bridge">Java bridge</a> replaces Java methods on Android has up until
now been accomplished by mutating the in-memory method metadata so that the
target method becomes native – if it wasn’t already. This allows us to install
a NativeCallback that matches the given method’s JNI signature.</p>

<p>This has presented some challenges, as the ART runtime does have other internal
state that depends on the given method’s personality. We have devised a few
hacks to dance around some of these issues, but some particularly gnarly
edge-cases remained unsolved. One such example is JIT profiling data maintained
by the ART VM.</p>

<p>An idea I had been thinking about for a while was to stop mutating the method
metadata, and instead perform inline hooking of the AOT-generated machine code –
for non-native methods that is. That still leaves methods run on the VM’s
interpreter, but the assumption was that we could deal with those by hooking
VM internals.</p>

<p>I took a stab at an early prototype to explore this approach further. It seemed
like it could work, but there were still many challenges to work through. After
some brainstorming with <a href="https://github.com/muhzii">@muhzii</a>, he kept working on evolving this rough PoC
further in his spare time. Then one day I almost fell off my chair out of pure
excitement when I saw the amazing pull-request he had just opened.</p>

<p>Thanks to Muhammed’s amazing work, you can now all enjoy a much improved Java
instrumentation experience on Android. This means improved stability and also
that direct calls won’t bypass your replacement method. Yay!</p>

<h2 id="deoptimization">Deoptimization</h2>

<p>For those of you using Java.deoptimizeEverything() on Android to ensure that
your hooks aren’t skipped due to optimizations, there’s now a more granular
alternative. Thanks to <a href="https://twitter.com/alkalinesec">@alkalinesec</a>’s neat contribution to our Java bridge,
you can now use Java.deoptimizeBootImage(). It ensures only code in the boot
image OAT files gets deoptimized. This is a serious performance gain in some
situations where the app code itself is slow when deoptimized, and it is not
necessary to deoptimize it in order for hooks to be hit reliably.</p>

<h2 id="cmodule">CModule</h2>

<p>Another really exciting update here. The next hero in our story is <a href="https://github.com/mephi42">@mephi42</a>,
who started porting Frida to S390x. Our CModule implementation relies on TinyCC
behind the scenes, and it doesn’t yet support this architecture. The system
might have a C compiler though, so @mephi42 proposed that we add support for
using GCC on systems where TinyCC cannot help us out.</p>

<p>I really liked this idea. Not only from the perspective of architecture support,
but also because of the potential for much faster code – TinyCC optimizes for
small compiler footprint and fast compilation, not fast code.</p>

<p>So needless to say I got more and more excited with each pull-request towards
GCC support. Once the last one landed it inspired me to add support for using
Apple’s clang on i/macOS.</p>

<p>In the end we arrived at this:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">cm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CModule</span><span class="p">(</span><span class="s2">`…`</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span> <span class="na">toolchain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">external</span><span class="dl">'</span> <span class="p">});</span></code></pre></figure>

<p>Where <code class="language-plaintext highlighter-rouge">toolchain</code> is either <code class="language-plaintext highlighter-rouge">any</code>, <code class="language-plaintext highlighter-rouge">internal</code>, or <code class="language-plaintext highlighter-rouge">external</code>. The default is
<code class="language-plaintext highlighter-rouge">any</code>, which means we will use TinyCC if it supports your <code class="language-plaintext highlighter-rouge">Process.arch</code>, and
fall back to <code class="language-plaintext highlighter-rouge">external</code> otherwise.</p>

<p>The story doesn’t end here, though. While implementing support for i/macOS,
it wasn’t really clear to me how we could fuse in symbols provided by the
JavaScript side. (The second argument to CModule’s constructor.)</p>

<p>The GCC implementation uses a linker script, which is a really elegant solution
that Apple’s linker doesn’t support. But then it hit me: we already have our own
dynamic linker that we use for our injector.</p>

<p>Once I had wired that up, it seemed really obvious that we could also trivially
support skipping Clang entirely, and allow the user to pass in a precompiled
shared library.</p>

<p>The thinking there was that it would enable cross-compilation, but also make it
possible to implement a CModule in languages such as Swift and Rust: basically
anything that can interop with C.</p>

<p>So this means we now also support the following:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">cm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CModule</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span></code></pre></figure>

<p>Where <code class="language-plaintext highlighter-rouge">blob</code> is an ArrayBuffer containing the shared library to construct it
from. For now this part is only implemented on i/macOS, but the goal is to
support this on all platforms. (Contributions welcome!)</p>

<p>Also, as of frida-tools 9.2, the REPL’s <code class="language-plaintext highlighter-rouge">-C</code> switch also supports this, making
it easy to use an external toolchain without missing out on live-reload – which
makes for a much shorter feedback loop during development.</p>

<p>Taking that one step further, the CModule API now also provides a the property
<code class="language-plaintext highlighter-rouge">CModule.builtins</code>, which scaffolding tools can use to obtain the built-in
headers and preprocessor defines.</p>

<p>And on that note we now have such a tool in frida-tools:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">mkdir </span>pewpew
<span class="nv">$ </span><span class="nb">cd </span>pewpew
<span class="nv">$ </span>frida-create cmodule
Created ./meson.build
Created ./pewpew.c
Created ./.gitignore
Created ./include/glib.h
Created ./include/gum/gumstalker.h
Created ./include/gum/gumprocess.h
Created ./include/gum/gummetalarray.h
Created ./include/gum/guminterceptor.h
Created ./include/gum/gumspinlock.h
Created ./include/gum/gummetalhash.h
Created ./include/gum/gummemory.h
Created ./include/gum/gumdefs.h
Created ./include/gum/gummodulemap.h
Created ./include/json-glib/json-glib.h
Created ./include/gum/arch-x86/gumx86writer.h
Created ./include/capstone.h
Created ./include/x86.h
Created ./include/platform.h

Run <span class="sb">`</span>meson build <span class="o">&amp;&amp;</span> ninja <span class="nt">-C</span> build<span class="sb">`</span> to build, <span class="k">then</span>:
- Inject CModule using the REPL: frida Calculator <span class="nt">-C</span> ./build/pewpew.dylib
- Edit <span class="k">*</span>.c, and build incrementally through <span class="sb">`</span>ninja <span class="nt">-C</span> build<span class="sb">`</span>
- REPL will live-reload whenever ./build/pewpew.dylib changes on disk

<span class="nv">$ </span>meson build <span class="o">&amp;&amp;</span> ninja <span class="nt">-C</span> build
…
<span class="o">[</span>2/2] Linking target pewpew.dylib
<span class="nv">$ </span>frida Calculator <span class="nt">-C</span> ./build/pewpew.dylib
…
init<span class="o">()</span>
<span class="o">[</span>Local::Calculator]-&gt;</code></pre></figure>

<p>And yes, it live-reloads! Taken to the extreme you could use a file-watcher tool
and make it run <code class="language-plaintext highlighter-rouge">ninja -C build</code> whenever <code class="language-plaintext highlighter-rouge">pewpew.c</code> changes – then just save
and instantly see the instrumentation go live in the target process.</p>

<p>It’s worth noting that you can also use the above when using the internal
CModule toolchain, as having the headers available on disk is handy for editor
features such as code completion.</p>

<h2 id="eof">EOF</h2>

<p>There’s also a bunch of other exciting changes, so definitely check out the
changelog below.</p>

<p>Enjoy!</p>

<h3 id="changes-in-1420">Changes in 14.2.0</h3>

<ul>
  <li>Brand new realms API for instrumenting emulated realms inside native
processes. Only implemented on Android for now.</li>
  <li>Add Java.deoptimizeBootImage(). Thanks <a href="https://twitter.com/alkalinesec">@alkalinesec</a>!</li>
  <li>Add –disable-preload/-P to frida-server. Useful in case of OS compatibility
issues where Frida crashes certain OS processes when attaching to them.</li>
  <li>Fix libc detection on older versions of Android.</li>
  <li>Fix crash when resolving export of the vDSO on Android. Thanks <a href="https://github.com/ant9000">@ant9000</a>!</li>
  <li>Restore support for libhoudini on Android.</li>
  <li>Fix ARM cache flushing on Android 11’s translator.</li>
  <li>Fix linker offsets for Android 5.x. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Start refactoring CModule’s internals to prepare for multiple backends. Thanks
<a href="https://github.com/mephi42">@mephi42</a>!</li>
  <li>Fix CModule aggregate initializations on ARM.</li>
  <li>Fix ModuleApiResolver fast-path emitting bad matches.</li>
</ul>

<h3 id="changes-in-1421">Changes in 14.2.1</h3>

<ul>
  <li>Fix CModule constructor error-path in the V8 runtime.</li>
  <li>Use V8 runtime for the “system_server” agent on Android.</li>
</ul>

<h3 id="changes-in-1422">Changes in 14.2.2</h3>

<ul>
  <li>Fix Darwin.Mapper arm64e handling of pages without fixups. This went unnoticed
out of pure “luck”, until our binaries eventually mutated sufficiently to
expose this bug.</li>
</ul>

<h3 id="changes-in-1423">Changes in 14.2.3</h3>

<ul>
  <li>Upgrade to using inline hooking for the ART runtime. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Fix direct transport regression on i/macOS, introduced by GLib upgrade where
GLib.Socket gained GLib.Credentials support on Apple OSes. A typical symptom
of this regression is that frida-server gets killed by Jetsam.</li>
  <li>Fix libffi support for stdcall, thiscall, and fastcall on 32-bit Windows.</li>
  <li>Extend Memory.alloc() to support allocating near a given address. Thanks
<a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Fix relocation of RIP-relative indirect branches on x86_64. Thanks
<a href="https://github.com/dkw72n">@dkw72n</a>!</li>
  <li>Improve the JVM C++ allocator API probing logic by consulting debug symbols
before giving up. Thanks <a href="https://github.com/Happyholic1203">@Happyholic1203</a>!</li>
  <li>Upgrade SELinux libraries to support bleeding edge Android systems.</li>
  <li>Add gum-linux-x86_64-gir target for GIR generation. Thanks <a href="https://github.com/meme">@meme</a>!</li>
</ul>

<h3 id="changes-in-1424">Changes in 14.2.4</h3>

<ul>
  <li>Fix Android performance regression when ART’s interpreter is used, such as
when using deoptimizeEverything() or deoptimizeBootImage(), which results in
our JS callbacks becoming extremely hot. Move the hot callbacks to CModule to
speed things up.</li>
  <li>Fix V8 debugger support in Node.js bindings on Linux.</li>
  <li>Fix crash on ELF init error in the libdwarf backend.</li>
</ul>

<h3 id="changes-in-1425">Changes in 14.2.5</h3>

<ul>
  <li>Fix regression on older Android systems, introduced in 14.2.4.</li>
</ul>

<h3 id="changes-in-1426">Changes in 14.2.6</h3>

<ul>
  <li>Fix compatibility with legacy NativeBridge v3 and newer, where a namespace
needs to be specified.</li>
</ul>

<h3 id="changes-in-1427">Changes in 14.2.7</h3>

<ul>
  <li>Fix frida-java-bridge crash on systems where printf() renders %p without
“0x” prefix.</li>
  <li>Fix jni_ids_indirection_ offset parsing on ARM64. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
</ul>

<h3 id="changes-in-1428">Changes in 14.2.8</h3>

<ul>
  <li>Fix GLib SO_NOSIGPIPE regression on i/macOS. This would typically result in
frida-server dying due to SIGPIPE. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Refactor CModule internals and lay foundations for GCC backend. Thanks
<a href="https://github.com/mephi42">@mephi42</a>!</li>
  <li>Add EventSink.make_from_callback() for Stalker C API consumers that only care
about events, and don’t need lifecycle hooks or code transformations.</li>
  <li>Emit Stalker BLOCK event at the start of the block, as this is what’s the most
intuitive, as one would expect at least as many BLOCK events as COMPILE
events. This behavior is also the most suitable for measuring coverage.</li>
  <li>Add Stalker prefetch support, useful for optimizing “AFL fork server”-like
use-cases.</li>
</ul>

<h3 id="changes-in-1429">Changes in 14.2.9</h3>

<ul>
  <li>Handle permanent entries in Darwin CodeSegment backend. Starting from iOS 14.3
on A12+ devices, mach_vm_remap() can return KERN_NO_SPACE when the target VM
map entries are marked as “permanent”. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Wire up GCC support in CModule. Thanks <a href="https://github.com/mephi42">@mephi42</a>!</li>
  <li>Add CModule backend for Clang on Apple OSes.</li>
  <li>Add support for linking in a prebuilt CModule. (Only on i/macOS for now.)</li>
  <li>Finalize the CModule toolchain selection API.</li>
  <li>Add CModule.builtins property for tooling support.</li>
  <li>Generate frida-core GIR by default. Thanks <a href="https://github.com/meme">@meme</a>!</li>
  <li>Fix regressions on Linux/MIPS.</li>
</ul>

<h3 id="changes-in-14210">Changes in 14.2.10</h3>

<ul>
  <li>Improve frida-inject to support bidirectional stdio.</li>
  <li>Add support for Termux in frida-python: <code class="language-plaintext highlighter-rouge">pip install frida-tools</code> now works.</li>
</ul>

<h3 id="changes-in-14211">Changes in 14.2.11</h3>

<ul>
  <li>Improve frida-inject to support raw terminal mode.</li>
  <li>Add internal policy daemon for Darwin.</li>
  <li>Improve Gum.Darwin.Mapper to support strict kernels.</li>
</ul>

<h3 id="changes-in-14212">Changes in 14.2.12</h3>

<ul>
  <li>Fix ART method hooking reliability after GC. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
</ul>

<h3 id="changes-in-14213">Changes in 14.2.13</h3>

<ul>
  <li>Fix Instruction operands parsing on x86, ensuring the immediate value is
always represented by an Int64 and never a number. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Fix frida-inject when process is not attached to a terminal. Thanks
<a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Expose Base64 and Checksum GLib primitives to CModule. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
</ul>

<h3 id="changes-in-14214">Changes in 14.2.14</h3>

<ul>
  <li>Fix Gadget crash on i/macOS when loaded early.</li>
  <li>Make frida-inject stdin communication optional. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Support iOS app spawn on unc0ver 6.x. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Work around single-step delay when spawning iOS apps, to avoid failing
randomly. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Fix read() signature mismatch in the libc shim, which would result in a
compilation error on newer Apple toolchains. Thanks <a href="https://github.com/Manouchehri">@Manouchehri</a>!</li>
  <li>Fix Android enumerate_applications() name truncation on newer versions of
Android. Kudos to <a href="https://twitter.com/trufae">@pancake</a> for reporting and helping figure this one out!</li>
  <li>Fix hang when target is unable to load frida-agent.</li>
  <li>Fix support for attaching to Windows services.</li>
  <li>Clean up stale Windows services before registering new ones.</li>
  <li>Add build option to support using installed assets instead of embedding them.</li>
  <li>Update iOS packaging to use installed assets.</li>
  <li>Add basic support for jailed Android. Thanks <a href="https://twitter.com/enovella_">@enovella_</a> for all the fun
and productive pair-programming on this one!</li>
  <li>Extend Arm64Writer API to support more immediates.</li>
  <li>Improve Stalker to support temporarily misaligned stack on arm64.</li>
  <li>Fix crash in Stalker follow() without a sink.</li>
  <li>Implement Stalker invalidation support. This allows updating the
instrumentation without throwing away all of the translated code. Thanks
for the assist on this one, <a href="https://twitter.com/p1onk">@p1onk</a>!</li>
  <li>Add Gum.DarwinModule.enumerate_function_starts().</li>
  <li>Add Gum.DarwinGrafter for AOT grafting to be able to prepare binaries so they
can be instrumented when runtime code modification isn’t possible. Thanks for
the assist, <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Add Memory.allocate_near().</li>
  <li>Improve Stalker performance and robustness on all supported architectures:
    <ul>
      <li>Improve call probes to probe at the target instead of at the call
site, and take advantage of the new invalidation infrastructure.</li>
      <li>Handle adding/removing call probes from within call probes.</li>
      <li>Refactor callout-handling so user data can be destroyed on invalidate.
This also eliminates the callout lock.</li>
      <li>In case of self-modifying code, recompile instead of allocating a new
block.</li>
      <li>Use separate slabs for code and data, to avoid cases where we only
use part of the slab because we run out of metadata storage.</li>
      <li>Inline the first code/data slab in ExecCtx, so we use a lot less
memory when following threads that either don’t touch much code, or
none at all in case they don’t wake up.</li>
      <li>Don’t bother storing original code when trust_threshold is 0.</li>
      <li>Simplify Stalker block metadata to reduce the per-block memory
consumption.</li>
    </ul>
  </li>
  <li>Fix result of Java.enumerateMethods() on ART. This was a bug where static
initializer methods were being included in the enumerated set as ‘$init’ when
they should be skipped altogether. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Fix the Android/ART near memory allocation code path used during Java method
hooking. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Fix handling of generic Java array types. This allows array objects obtained
from the runtime to be reused later when marshalling array types, which is
necessary to preserve type information particularly in cases where the type
is dynamic. Thanks <a href="https://github.com/muhzii">@muhzii</a>!</li>
  <li>Port Android/ART StackVisitor to x86, x64, and ARM32. Thanks <a href="https://github.com/P-Sc">@P-Sc</a>!</li>
  <li>Fix ARM cache flushing on Android. Turns out cacheflush() expects a range on
Linux/ARM. This 32-bit Android/ARM regression was introduced in 14.2.0.</li>
  <li>Add a few missing TinyCC builtins for 32-bit ARM.  Kudos to <a href="https://twitter.com/giantpune">@giantpune</a> for
reporting and helping figure this one out!</li>
  <li>Fix wrap-around in Stalker block recycling logic.</li>
  <li>Fix V8 NativePointer construction from large numbers.</li>
  <li>Fix Stalker local thread actions on Windows.</li>
  <li>Fix the CModule temporary directory cleanup logic.</li>
  <li>Remove forgotten InspectorServer debug code.</li>
  <li>Fix the V8 debugger integration. Kudos to <a href="https://twitter.com/taviso">@taviso</a> for reporting!</li>
</ul>

<h3 id="changes-in-14215">Changes in 14.2.15</h3>

<ul>
  <li>Fix compatibility with latest unc0ver iOS jailbreak. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Add support for Anbox. Thanks <a href="https://twitter.com/asabil">@asabil</a>!</li>
  <li>Add Java.deoptimizeMethod(). Thanks <a href="https://github.com/liuyufei">@liuyufei</a>!</li>
  <li>Handle replacing ART methods that may be devirtualized. Thanks <a href="https://github.com/liuyufei">@liuyufei</a>!</li>
</ul>

<h3 id="changes-in-14216">Changes in 14.2.16</h3>

<ul>
  <li>Add many missing TinyCC builtins for 32-bit ARM. Kudos to <a href="https://twitter.com/giantpune">@giantpune</a> for
reporting and helping figure this one out!</li>
  <li>Fix Android ART trampoline alignment when using ADRP on arm64, previously
resulting in <code class="language-plaintext highlighter-rouge">Error: invalid argument</code> exception being thrown when attempting
to replace some methods. Kudos to <a href="https://github.com/pandasauce">@pandasauce</a> for reporting and helping
figure this one out!</li>
</ul>

<h3 id="changes-in-14217">Changes in 14.2.17</h3>

<ul>
  <li>Enumerate Darwin imports from chained fixups, to support the latest arm64e
binaries. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Fix chained fixups handling in the jailed iOS injector. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>qml: Compile with <em>no_keywords</em> for GLib compatibility. Thanks <a href="https://github.com/suy">@suy</a>!</li>
</ul>

<h3 id="changes-in-14218">Changes in 14.2.18</h3>

<ul>
  <li>Fix i/macOS injector on recent XNU versions, where mach_port_extract_right()
fails with KERN_INVALID_CAPABILITY when trying to steal the target process’
POSIX thread port send right. This resulted in the injector assuming that we’d
uninjected, subsequently deallocating memory still in use.</li>
  <li>Fix ___error symbol name in the jailed iOS injector. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Fix enumeration of modules with spaces on path in the Linux backend. Thanks
<a href="https://github.com/suy">@suy</a>!</li>
  <li>Fix Stalker handling of direct branch addresses on x64.</li>
  <li>python: Add RPC exports listing functionality. Thanks <a href="https://github.com/NewbieGoose">@NewbieGoose</a>!</li>
</ul>


  </p>
</article>

      </div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit whole align-right center-on-mobiles">
      <div class="sponsored-by">
        <h5>Sponsored by:</h5>
        <a href="https://www.nowsecure.com">
          <img src="../../../../../img/nowsecure-logo.png" alt="NowSecure">
        </a>
      </div>
    </div>
  </div>
</footer>

  


  <!-- Google Analytics (http://google.com/analytics) -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46880695-1']);
    _gaq.push(['_setDomainName', 'https://frida.re']); // Multiple sub-domains
    _gaq.push(['_setAllowLinker', true]); // Multiple TLDs
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
