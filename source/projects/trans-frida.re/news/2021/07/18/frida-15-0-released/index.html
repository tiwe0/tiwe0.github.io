<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Jekyll v4.2.0">
  <link type="application/atom+xml" rel="alternate" href="../../../../../feed.xml" title="Frida • A world-class dynamic instrumentation toolkit" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Frida’s master branch" href="https://github.com/frida/frida/commits/master.atom" />
  <link rel="stylesheet" href="../../../../../css/screen.css" />
  <link rel="icon" type="image/png" href="../../../../../favicon.ico" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Frida 15.0 Released | Frida • A world-class dynamic instrumentation toolkit</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Frida 15.0 Released" />
<meta name="author" content="oleavr" />
<meta property="og:locale" content="en" />
<meta name="description" content="Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX" />
<meta property="og:description" content="Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX" />
<link rel="canonical" href="index.html" />
<meta property="og:url" content="https://frida.re/news/2021/07/18/frida-15-0-released/" />
<meta property="og:site_name" content="Frida • A world-class dynamic instrumentation toolkit" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-18T00:48:05+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Frida 15.0 Released" />
<meta name="twitter:site" content="@fridadotre" />
<meta name="twitter:creator" content="@oleavr" />
<script type="application/ld+json">
{"headline":"Frida 15.0 Released","dateModified":"2021-07-18T00:48:05+02:00","datePublished":"2021-07-18T00:48:05+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://frida.re/news/2021/07/18/frida-15-0-released/"},"author":{"@type":"Person","name":"oleavr"},"@type":"BlogPosting","description":"Observe and reprogram running programs on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX","url":"https://frida.re/news/2021/07/18/frida-15-0-released/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <script src="../../../../../js/modernizr-2.5.3.min.js"></script>
</head>


<body class="wrap">
  <header>
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="../../../../../index.html">Overview</a>
  </li>
  <li class="">
    <a href="../../../../../docs/home/index.html">Docs</span></a>
  </li>
  <li class="current">
    <a href="../../../../index.html">News</a>
  </li>
  <li class="">
    <a href="https://github.com/frida/frida">Code</a>
  </li>
  <li class="">
    <a href="../../../../../contact/index.html">Contact</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="logotype unit one-third center-on-mobiles">
      <a href="../../../../../index.html">
        <span>FЯIDA</span>
        <img src="../../../../../img/logotype.svg" width="205" height="39" alt="">
      </a>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="../../../../../index.html">Overview</a>
  </li>
  <li class="">
    <a href="../../../../../docs/home/index.html">Docs</span></a>
  </li>
  <li class="current">
    <a href="../../../../index.html">News</a>
  </li>
  <li class="">
    <a href="https://github.com/frida/frida">Code</a>
  </li>
  <li class="">
    <a href="../../../../../contact/index.html">Contact</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="news">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the blog…</option>
    <option value="/news/">Home</option>
    <optgroup label="v1.x">
      
      <option value="/news/2023/12/24/frida-16-1-10-released/">Frida 16.1.10 Released</option>
      
      <option value="/news/2023/12/20/frida-16-1-9-released/">Frida 16.1.9 Released</option>
      
      <option value="/news/2023/11/28/frida-16-1-8-released/">Frida 16.1.8 Released</option>
      
      <option value="/news/2023/11/16/frida-16-1-7-released/">Frida 16.1.7 Released</option>
      
      <option value="/news/2023/11/13/frida-16-1-6-released/">Frida 16.1.6 Released</option>
      
      <option value="/news/2023/11/04/frida-16-1-5-released/">Frida 16.1.5 Released</option>
      
      <option value="/news/2023/08/29/frida-16-1-4-released/">Frida 16.1.4 Released</option>
      
      <option value="/news/2023/07/14/frida-16-1-3-released/">Frida 16.1.3 Released</option>
      
      <option value="/news/2023/07/11/frida-16-1-2-released/">Frida 16.1.2 Released</option>
      
      <option value="/news/2023/07/01/frida-16-1-1-released/">Frida 16.1.1 Released</option>
      
      <option value="/news/2023/06/23/frida-16-1-0-released/">Frida 16.1.0 Released</option>
      
      <option value="/news/2023/04/27/frida-16-0-19-released/">Frida 16.0.19 Released</option>
      
      <option value="/news/2023/04/22/frida-16-0-18-released/">Frida 16.0.18 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-17-released/">Frida 16.0.17 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-16-released/">Frida 16.0.16 Released</option>
      
      <option value="/news/2023/04/19/frida-16-0-15-released/">Frida 16.0.15 Released</option>
      
      <option value="/news/2023/04/18/frida-16-0-14-released/">Frida 16.0.14 Released</option>
      
      <option value="/news/2023/04/15/frida-16-0-13-released/">Frida 16.0.13 Released</option>
      
      <option value="/news/2023/04/14/frida-16-0-12-released/">Frida 16.0.12 Released</option>
      
      <option value="/news/2023/03/10/frida-16-0-11-released/">Frida 16.0.11 Released</option>
      
      <option value="/news/2023/02/17/frida-16-0-10-released/">Frida 16.0.10 Released</option>
      
      <option value="/news/2023/02/11/frida-16-0-9-released/">Frida 16.0.9 Released</option>
      
      <option value="/news/2022/12/13/frida-16-0-8-released/">Frida 16.0.8 Released</option>
      
      <option value="/news/2022/12/02/frida-16-0-7-released/">Frida 16.0.7 Released</option>
      
      <option value="/news/2022/12/01/frida-16-0-6-released/">Frida 16.0.6 Released</option>
      
      <option value="/news/2022/11/28/frida-16-0-5-released/">Frida 16.0.5 Released</option>
      
      <option value="/news/2022/11/26/frida-16-0-4-released/">Frida 16.0.4 Released</option>
      
      <option value="/news/2022/11/23/frida-16-0-3-released/">Frida 16.0.3 Released</option>
      
      <option value="/news/2022/10/22/frida-16-0-2-released/">Frida 16.0.2 Released</option>
      
      <option value="/news/2022/10/08/frida-16-0-1-released/">Frida 16.0.1 Released</option>
      
      <option value="/news/2022/10/08/frida-16-0-0-released/">Frida 16.0.0 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-2-released/">Frida 15.2.2 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-1-released/">Frida 15.2.1 Released</option>
      
      <option value="/news/2022/07/21/frida-15-2-0-released/">Frida 15.2.0 Released</option>
      
      <option value="/news/2022/07/06/frida-15-1-28-released/">Frida 15.1.28 Released</option>
      
      <option value="/news/2022/06/20/frida-15-1-27-released/">Frida 15.1.27 Released</option>
      
      <option value="/news/2022/06/20/frida-15-1-26-released/">Frida 15.1.26 Released</option>
      
      <option value="/news/2022/06/18/frida-15-1-25-released/">Frida 15.1.25 Released</option>
      
      <option value="/news/2022/06/03/frida-15-1-24-released/">Frida 15.1.24 Released</option>
      
      <option value="/news/2022/05/30/frida-15-1-23-released/">Frida 15.1.23 Released</option>
      
      <option value="/news/2022/05/09/frida-15-1-22-released/">Frida 15.1.22 Released</option>
      
      <option value="/news/2022/05/06/frida-15-1-21-released/">Frida 15.1.21 Released</option>
      
      <option value="/news/2022/05/06/frida-15-1-20-released/">Frida 15.1.20 Released</option>
      
      <option value="/news/2022/05/04/frida-15-1-19-released/">Frida 15.1.19 Released</option>
      
      <option value="/news/2022/05/04/frida-15-1-18-released/">Frida 15.1.18 Released</option>
      
      <option value="/news/2022/02/10/frida-15-1-17-released/">Frida 15.1.17 Released</option>
      
      <option value="/news/2022/02/03/frida-15-1-16-released/">Frida 15.1.16 Released</option>
      
      <option value="/news/2022/02/01/frida-15-1-15-released/">Frida 15.1.15 Released</option>
      
      <option value="/news/2021/09/03/frida-15-1-released/">Frida 15.1 Released</option>
      
      <option value="/news/2021/07/18/frida-15-0-released/">Frida 15.0 Released</option>
      
      <option value="/news/2021/02/10/frida-14-2-released/">Frida 14.2 Released</option>
      
      <option value="/news/2020/12/01/frida-14-1-released/">Frida 14.1 Released</option>
      
      <option value="/news/2020/10/28/frida-14-0-released/">Frida 14.0 Released</option>
      
      <option value="/news/2020/07/24/frida-12-11-released/">Frida 12.11 Released</option>
      
      <option value="/news/2020/06/29/frida-12-10-released/">Frida 12.10 Released</option>
      
      <option value="/news/2020/05/19/frida-12-9-released/">Frida 12.9 Released</option>
      
      <option value="/news/2019/12/18/frida-12-8-released/">Frida 12.8 Released</option>
      
      <option value="/news/2019/09/18/frida-12-7-released/">Frida 12.7 Released</option>
      
      <option value="/news/2019/05/28/frida-12-6-released/">Frida 12.6 Released</option>
      
      <option value="/news/2019/05/15/nowsecure-connect-2019/">NowSecure Connect 2019</option>
      
      <option value="/news/2019/05/15/frida-12-5-released/">Frida 12.5 Released</option>
      
      <option value="/news/2018/09/11/frida-12-2-released/">Frida 12.2 Released</option>
      
      <option value="/news/2018/08/25/frida-12-1-released/">Frida 12.1 Released</option>
      
      <option value="/news/2018/07/12/frida-12-0-released/">Frida 12.0 Released</option>
      
      <option value="/news/2018/05/05/frida-11-0-released/">Frida 11.0 Released</option>
      
      <option value="/news/2018/04/28/frida-10-8-released/">Frida 10.8 Released</option>
      
      <option value="/news/2018/03/13/frida-10-7-released/">Frida 10.7 Released</option>
      
      <option value="/news/2017/09/29/frida-10-6-released/">Frida 10.6 Released</option>
      
      <option value="/news/2017/08/25/frida-10-5-released/">Frida 10.5 Released</option>
      
      <option value="/news/2017/08/15/frida-10-4-released/">Frida 10.4 Released</option>
      
      <option value="/news/2017/05/02/frida-10-0-released/">Frida 10.0 Released</option>
      
      <option value="/news/2017/01/09/frida-9-0-released/">Frida 9.0 Released</option>
      
      <option value="/news/2016/10/25/frida-8-1-released/">Frida 8.1 Released</option>
      
      <option value="/news/2016/10/04/frida-8-0-released/">Frida 8.0 Released</option>
      
      <option value="/news/2016/08/15/frida-7-3-released/">Frida 7.3 Released</option>
      
      <option value="/news/2016/06/02/frida-7-2-released/">Frida 7.2 Released</option>
      
      <option value="/news/2016/04/04/frida-7-1-released/">Frida 7.1 Released</option>
      
      <option value="/news/2016/02/24/frida-7-0-released/">Frida 7.0 Released</option>
      
      <option value="/news/2016/02/01/frida-6-2-released/">Frida 6.2 Released</option>
      
      <option value="/news/2016/01/31/frida-fosdem-presentation/">Frida presentation at FOSDEM 2016</option>
      
      <option value="/news/2016/01/14/frida-6-1-released/">Frida 6.1 Released</option>
      
      <option value="/news/2015/11/11/frida-6-0-released/">Frida 6.0 Released</option>
      
      <option value="/news/2015/09/17/frida-5-0-released/">Frida 5.0 Released</option>
      
      <option value="/news/2015/09/10/frida-4-5-released/">Frida 4.5 Released</option>
      
      <option value="/news/2015/07/31/frida-4-4-released/">Frida 4.4 Released</option>
      
      <option value="/news/2015/07/15/frida-4-3-released/">Frida 4.3 Released</option>
      
      <option value="/news/2015/06/18/frida-4-2-released/">Frida 4.2 Released</option>
      
      <option value="/news/2015/06/09/frida-4-1-released/">Frida 4.1 Released</option>
      
      <option value="/news/2015/05/09/frida-4-0-0-released/">Frida 4.0.0 Released</option>
      
      <option value="/news/2015/03/20/frida-3-0-0-released/">Frida 3.0.0 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-2-released/">Frida 2.0.2 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-1-released/">Frida 2.0.1 Released</option>
      
      <option value="/news/2015/03/01/frida-2-0-0-released/">Frida 2.0.0 Released</option>
      
      <option value="/news/2015/02/23/frida-1-8-0-released/">Frida 1.8.0 Released</option>
      
      <option value="/news/2014/11/18/frida-1-6-8-released/">Frida 1.6.8 Released</option>
      
      <option value="/news/2014/11/03/frida-1-6-7-released/">Frida 1.6.7 Released</option>
      
      <option value="/news/2014/11/03/frida-1-6-6-released/">Frida 1.6.6 Released</option>
      
      <option value="/news/2014/10/29/frida-1-6-5-released/">Frida 1.6.5 Released</option>
      
      <option value="/news/2014/10/19/frida-1-6-4-released/">Frida 1.6.4 Released</option>
      
      <option value="/news/2014/08/25/frida-1-6-3-released/">Frida 1.6.3 Released</option>
      
      <option value="/news/2014/08/03/frida-1-6-2-released/">Frida 1.6.2 Released</option>
      
      <option value="/news/2014/07/26/frida-1-6-1-released/">Frida 1.6.1 Released</option>
      
      <option value="/news/2014/05/30/frida-1-6-0-released/">Frida 1.6.0 Released</option>
      
      <option value="/news/2014/05/14/frida-1-4-2-released/">Frida 1.4.2 Released</option>
      
      <option value="/news/2014/05/14/frida-1-4-1-released/">Frida 1.4.1 Released</option>
      
      <option value="/news/2014/05/04/frida-1-4-0-released/">Frida 1.4.0 Released</option>
      
      <option value="/news/2014/04/21/frida-1-2-1-released/">Frida 1.2.1 Released</option>
      
      <option value="/news/2014/04/17/frida-1-2-0-released/">Frida 1.2.0 Released</option>
      
      <option value="/news/2014/03/09/frida-1-0-11-released/">Frida 1.0.11 Released</option>
      
      <option value="/news/2014/02/16/frida-1-0-10-released/">Frida 1.0.10 Released</option>
      
      <option value="/news/2014/01/25/frida-1-0-9-released/">Frida 1.0.9 Released</option>
      
      <option value="/news/2014/01/15/frida-1-0-8-released/">Frida 1.0.8 Released</option>
      
      <option value="/news/2014/01/12/frida-1-0-7-released/">Frida 1.0.7 Released</option>
      
      <option value="/news/2014/01/11/frida-1-0-6-released/">Frida 1.0.6 Released</option>
      
      <option value="/news/2014/01/05/frida-1-0-5-released/">Frida 1.0.5 Released</option>
      
    </optgroup>
  </select>
</div>

      <div class="news-nav-desktop unit one-quarter hide-on-mobiles">
  <aside>
    <ul>
      <li class="">
        <a href="../../../../index.html">All News</a>
      </li>
      <li class="">
        <a href="../../../../releases/index.html">Frida Releases</a>
      </li>
    </ul>
    <h4>Recent Releases</h4>
    <ul>
      
      <li class="">
        <a href="../../../../2023/12/24/frida-16-1-10-released/index.html">Version 16.1.10</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/12/20/frida-16-1-9-released/index.html">Version 16.1.9</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/28/frida-16-1-8-released/index.html">Version 16.1.8</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/16/frida-16-1-7-released/index.html">Version 16.1.7</a>
      </li>
      
      <li class="">
        <a href="../../../../2023/11/13/frida-16-1-6-released/index.html">Version 16.1.6</a>
      </li>
      
      <li>
        <a href="../../../../../docs/history/index.html">History »</a>
      </li>
    </ul>
    <h4>Other News</h4>
    <ul>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="">
          <a href="../../../../2019/05/15/nowsecure-connect-2019/index.html">NowSecure Connect 2019</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="">
          <a href="../../../../2016/01/31/frida-fosdem-presentation/index.html">Frida presentation at FOSDEM 2016</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </ul>
  </aside>
</div>


      <div class="news-articles unit three-quarters">
        <article>
  <h2>
    Frida 15.0 Released
    <a href="index.html" class="permalink" title="Permalink">∞</a>
  </h2>
  <span class="post-category">
    
    <span class="label">release</span>
    
  </span>
  <div class="post-meta">
    <span class="post-date">
      18 Jul 2021
    </span>
    <a href="https://github.com/oleavr" class="post-author">
      <img src="https://github.com/oleavr.png" class="avatar" />
      oleavr
    </a>
  </div>
  <p class="post-content">
    <p>So much has changed. Let’s kick things off with the big new feature that guided
most of the other changes in this release:</p>

<h2 id="portals">Portals</h2>

<h3 id="part-i-conception">Part I: Conception</h3>

<p>Earlier this year <a href="https://twitter.com/insitusec">@insitusec</a> and I were brainstorming ways we could simplify
distributed instrumentation use-cases. Essentially ship a Frida Gadget that’s
“hollow”, where application-specific instrumentation is provided by a backend.</p>

<p>One way one could implement this is by using the Socket.connect() JavaScript
API, and then define an application-specific signaling protocol over which the
code is loaded, before handing it off to the JavaScript runtime.</p>

<p>But this way of doing things does quickly end up with quite a bit of boring glue
code, and existing tools such as frida-trace won’t actually be usable in such a
setup.</p>

<p>That’s when @insitusec suggested that perhaps Frida’s Gadget could offer an
inverse counterpart to its <a href="../../../../../docs/gadget/index.html#listen">Listen</a> interaction. So instead of it being a
server that exposes a frida-server compatible interface, it could be configured
to act as a client that connects to a Portal.</p>

<p>Such a Portal then aggregates all of the connected gadgets, and also exposes a
frida-server compatible interface where all of them appear as processes. To the
outside it appears as if they’re processes on the same machine as where the
Portal is running: they all have unique process IDs if you use
enumerate_processes() or frida-ps, and one can attach() to them seamlessly.</p>

<p>In this way, existing Frida tools work exactly the same way – and by enabling
spawn-gating on the Portal, any Gadget connecting could be instructed to wait
for somebody to resume() it after applying the desired instrumentation. This
is the same way spawn-gating works in other situations.</p>

<h3 id="part-ii-implementation">Part II: Implementation</h3>

<p>Implementing this was a lot of fun, and it wasn’t long until the first PoC was
up and running. It took some time before all the details were clear, though, but
this eventually <a href="https://github.com/frida/frida-core/blob/0120cf59bc6f623bb842c93bc8870ce2a704453c/src/portal-service.vala">crystallized</a> into the following:</p>

<p>The Portal should expose two different interfaces:</p>

<ol>
  <li>The <strong><em>cluster</em></strong> interface that Gadgets can connect to, allowing them to join
the cluster.</li>
  <li>Optionally also a <strong><em>control</em></strong> interface that controllers can talk to. E.g.
<code class="language-plaintext highlighter-rouge">frida-trace -H my.portal.com -n Twitter -i open</code></li>
</ol>

<p>To a user this would be pretty simple: just grab the frida-portal binary from
our <a href="https://github.com/frida/frida/releases">releases</a>, and run it on some machine that the Gadget is able to
<a href="../../../../../docs/gadget/index.html#connect">reach</a>. Then point tools at that – as if it was a regular frida-server.</p>

<p>That is however only one part of the story – how it would be used for simple
use-cases. The frida-portal CLI program is actually nothing more than a thin CLI
wrapper around the underlying <em>PortalService</em>. This CLI program is just a bit
north of <a href="https://github.com/frida/frida-core/blob/0120cf59bc6f623bb842c93bc8870ce2a704453c/portal/portal.vala">200 lines of code</a>, of which very little is actual logic.</p>

<p>One can also use our frida-core language bindings, for e.g. Python or Node.js,
to instantiate the PortalService. This allows configuring it to not provide
any control interface, and instead access its <strong><em>device</em></strong> property. This is a
standard Frida Device object, on which one can enumerate_processes(), attach(),
etc. Or one can do both at the same time.</p>

<p>Using the API also offers other features, but we will get back to those.</p>

<h3 id="part-iii-tls">Part III: TLS</h3>

<p>Given how useful it might be to run a frida-portal on the public Internet, it
was also clear that we should support TLS. As we already had <a href="https://gitlab.gnome.org/GNOME/glib-networking">glib-networking</a>
among our dependencies for other features, this made it really cheap to add,
footprint-wise.</p>

<p>And implementation-wise it’s a tiny bit of logic on the <a href="https://github.com/frida/frida-core/blob/0120cf59bc6f623bb842c93bc8870ce2a704453c/src/socket/socket-host-session.vala#L117-L133">client</a> side, and
similarly straight-forward for the server side of the story.</p>

<p>For the CLI tools it’s only a matter of passing <code class="language-plaintext highlighter-rouge">--certificate=/path/to/pem</code>.
If it’s a server it expects a PEM-encoded file with a public + private key,
where it will accept any certificate from incoming clients. For a client it’s
also expecting a PEM-encoded file, but only with the public key of a trusted CA,
which the server’s certificate must match or be derived from.</p>

<p>At the API level it boils down to this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">frida</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">get_device_manager</span><span class="p">()</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">add_remote_device</span><span class="p">(</span><span class="s">"my.portal.com"</span><span class="p">,</span>
                                   <span class="n">certificate</span><span class="o">=</span><span class="s">"/path/to/pem/or/inline/pem-data"</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="s">"Twitter"</span><span class="p">)</span>
<span class="err">…</span></code></pre></figure>

<h3 id="part-iv-authentication">Part IV: Authentication</h3>

<p>The next fairly obvious feature that goes hand in hand with running a
frida-portal on the public Internet, is authentication. In this case our server
CLI programs now support <code class="language-plaintext highlighter-rouge">--token=secret</code>, and so do our CLI tools.</p>

<p>At the API level it’s also pretty simple:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">frida</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">get_device_manager</span><span class="p">()</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">add_remote_device</span><span class="p">(</span><span class="s">"my.portal.com"</span><span class="p">,</span>
                                   <span class="n">token</span><span class="o">=</span><span class="s">"secret"</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="s">"Twitter"</span><span class="p">)</span>
<span class="err">…</span></code></pre></figure>

<p>But this gets a lot more interesting if you instantiate the PortalService
through the API, as it makes it easy to plug in your own custom authentication
backend:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">frida</span>

<span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="c1"># Where `token` might be an OAuth access token
</span>    <span class="c1"># that is used to grab user details from e.g.
</span>    <span class="c1"># GitHub, Twitter, etc.
</span>    <span class="n">user</span> <span class="o">=</span> <span class="err">…</span>

    <span class="c1"># Attach some application-specific state to the connection.
</span>    <span class="k">return</span> <span class="p">{</span>
        <span class="s">'name'</span><span class="p">:</span> <span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">cluster_params</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">EndpointParameters</span><span class="p">(</span><span class="n">authentication</span><span class="o">=</span><span class="p">(</span><span class="s">'token'</span><span class="p">,</span> <span class="s">"wow-such-secret"</span><span class="p">))</span>
<span class="n">control_params</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">EndpointParameters</span><span class="p">(</span><span class="n">authentication</span><span class="o">=</span><span class="p">(</span><span class="s">'callback'</span><span class="p">,</span> <span class="n">authenticate</span><span class="p">))</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">PortalService</span><span class="p">(</span><span class="n">cluster_params</span><span class="p">,</span> <span class="n">control_params</span><span class="p">)</span></code></pre></figure>

<p>The EndpointParameters constructor also supports other options such as
<code class="language-plaintext highlighter-rouge">address</code>, <code class="language-plaintext highlighter-rouge">port</code>, <code class="language-plaintext highlighter-rouge">certificate</code>, etc.</p>

<h3 id="part-v-offline-mode">Part V: Offline Mode</h3>

<p>That leads us to our next challenge, which is how to deal with transient
connectivity issues. I did make sure to implement automatic reconnect logic in
<a href="https://github.com/frida/frida-core/blob/0120cf59bc6f623bb842c93bc8870ce2a704453c/lib/payload/portal-client.vala">PortalClient</a>, which is what Gadget uses to connect to the PortalService.</p>

<p>But even if the Gadget reconnects to the Portal, what should happen to loaded
scripts in the meantime? And what if the controller gets disconnected from the
Portal?</p>

<p>We now have a solution that handles both situations. But it’s opt-in, so the old
behavior is still the default.</p>

<p>Here’s how it’s done:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">session</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="s">"Twitter"</span><span class="p">,</span>
                        <span class="n">persist_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span></code></pre></figure>

<p>Now, once some connectivity glitch occurs, scripts will stay loaded on the
remote end, but any messages emitted will get queued. In the example above, the
client has 30 seconds to reconnect before scripts get unloaded and data is lost.</p>

<p>The controller would then subscribe to the <code class="language-plaintext highlighter-rouge">Session.detached</code> signal to be able
to handle this situation:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">on_detached</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="n">crash</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">reason</span> <span class="o">==</span> <span class="s">'connection-terminated'</span><span class="p">:</span>
        <span class="c1"># Oops. Better call session.resume()
</span>
<span class="n">session</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'detached'</span><span class="p">,</span> <span class="n">on_detached</span><span class="p">)</span></code></pre></figure>

<p>Once <code class="language-plaintext highlighter-rouge">session.resume()</code> succeeds, any buffered messages will be delivered and
life is good again.</p>

<p>The above example does gloss over a few details such as our current Python
bindings’ finicky threading constraints, but have a look at the full example
<a href="https://github.com/frida/frida-python/blob/bbdcdfaca821276361399775bd81599710ec0625/examples/session_persist_timeout.py">here</a>. (This will become a lot simpler once we port our Python bindings off
our synchronous APIs and onto async/await.)</p>

<h3 id="part-vi-latency-and-bottlenecks">Part VI: Latency and Bottlenecks</h3>

<p>Alright, so next up we’ve got a Portal running in a data center in the US, but
the Gadget is at my friend’s place in Spain, and I’m trying to control it from
Norway using frida-trace. It would be a shame if the script messages coming from
Spain would have to cross the Atlantic twice, not just because of the latency,
but also the AWS bill I’ll have to pay next month. Because I’m dumping memory
right now, and that’s quite a bit of traffic right there.</p>

<p>This one’s a bit harder, but thanks to <a href="https://libnice.freedesktop.org/">libnice</a>, a lightweight and mature ICE
implementation built on <a href="https://gitlab.gnome.org/GNOME/glib">GLib</a>, we can go ahead and use that. Given that GLib
is already part of our stack – as it’s our standard library for C programming
(and our Vala code compiles to C code that depends on GLib) – it’s a perfect
fit. And this is very good news footprint-wise.</p>

<p>As a user it’s only a matter of passing <code class="language-plaintext highlighter-rouge">--p2p</code> along with a STUN server:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida-trace <span class="se">\</span>
    <span class="nt">-H</span> my.portal.com <span class="se">\</span>
    <span class="nt">--p2p</span> <span class="se">\</span>
    <span class="nt">--stun-server</span><span class="o">=</span>my.stunserver.com <span class="se">\</span>
    <span class="nt">-n</span> Twitter <span class="se">\</span>
    <span class="nt">-i</span> open</code></pre></figure>

<p>(TURN relays are also supported.)</p>

<p>The API side of the story looks like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">session</span><span class="p">.</span><span class="n">setup_peer_connection</span><span class="p">(</span><span class="n">stun_server</span><span class="o">=</span><span class="s">"my.stunserver.com"</span><span class="p">)</span></code></pre></figure>

<p>That’s all there is to it!</p>

<h3 id="part-vii-are-only-gadgets-invited-to-the-party">Part VII: Are Only Gadgets Invited To The Party?</h3>

<p>You may have noticed that our Gadget has been a recurring theme so far. I’m not
very excited about adding features that only apply to one <a href="../../../../../docs/modes/index.html">mode</a>, such as
only Injected mode but not Embedded mode. So this was something that came to
mind quite early on, that Portals had to be a universally available feature.</p>

<p>So say my buddy is reversing a target on his iPhone from his living room in
Italy, and I’d like to join in on the fun, he can go ahead and run:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida-join <span class="nt">-U</span> ReversingTarget my.portal.com cert.pem secret</code></pre></figure>

<p>Now I can jump in with the Frida REPL:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida <span class="se">\</span>
    <span class="nt">-H</span> my.portal.com <span class="se">\</span>
    <span class="nt">--certificate</span><span class="o">=</span>cert.pem <span class="se">\</span>
    <span class="nt">--token</span><span class="o">=</span>secret <span class="se">\</span>
    <span class="nt">--p2p</span> <span class="se">\</span>
    <span class="nt">--stun-server</span><span class="o">=</span>my.stunserver.com <span class="se">\</span>
    <span class="nt">-n</span> ReversingTarget</code></pre></figure>

<p>And if my buddy would like to use the API to join the Portal, he can:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">session</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">get_usb_device</span><span class="p">().</span><span class="n">attach</span><span class="p">(</span><span class="s">"ReversingTarget"</span><span class="p">)</span>
<span class="n">membership</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">join_portal</span><span class="p">(</span><span class="s">"my.portal.com"</span><span class="p">,</span>
                                 <span class="n">certificate</span><span class="o">=</span><span class="s">"/path/to/cert.pem"</span><span class="p">,</span>
                                 <span class="n">token</span><span class="o">=</span><span class="s">"secret"</span><span class="p">)</span></code></pre></figure>

<h3 id="part-viii-the-web">Part VIII: The Web</h3>

<p>Something I’ve been wanting to build since before Frida was born, is an online
collaborative reversing app. Back in the very beginning of Frida, I built a
desktop GUI that had integrated chat, console, etc. My not-so-ample spare-time
was a challenge, however, so I eventually got rid of the GUI code and decided to
focus on the API instead.</p>

<p>Now we’re in 2021, and single-page apps (SPAs) can be a really appealing option
in many cases. I’ve also noticed that there’s been quite a few SPAs built on top
of Frida, and that’s super-exciting! But what I’ve noticed when toying with SPAs
on my own, is that it’s quite tedious to have to write the middleware.</p>

<p>Well, with Frida 15 I had to make some protocol changes to accomodate the
features that I’ve covered so far, so it also seemed like the right time to
really break the protocol and go ahead with a major-bump. This is something
I’ve been trying to avoid for a long time, as I know how painful they are to
everyone, myself included.</p>

<p>So now browsers can finally join in on the fun, without any middleware needed:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">async</span> <span class="kd">function</span> <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="nx">wrapEventStream</span><span class="p">(</span><span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">`ws://</span><span class="p">${</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="p">}</span><span class="s2">/ws`</span><span class="p">));</span>
  <span class="kd">const</span> <span class="nx">bus</span> <span class="o">=</span> <span class="nx">dbus</span><span class="p">.</span><span class="nx">peerBus</span><span class="p">(</span><span class="nx">ws</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">authMethods</span><span class="p">:</span> <span class="p">[],</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">hostSessionObj</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bus</span><span class="p">.</span><span class="nx">getProxyObject</span><span class="p">(</span><span class="dl">'</span><span class="s1">re.frida.HostSession15</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">/re/frida/HostSession</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">hostSession</span> <span class="o">=</span> <span class="nx">hostSessionObj</span><span class="p">.</span><span class="nx">getInterface</span><span class="p">(</span><span class="dl">'</span><span class="s1">re.frida.HostSession15</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">processes</span><span class="p">:</span> <span class="nx">HostProcessInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hostSession</span><span class="p">.</span><span class="nx">enumerateProcesses</span><span class="p">({});</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Got processes:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">processes</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">processes</span><span class="p">.</span><span class="nx">find</span><span class="p">(([,</span> <span class="nx">name</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">name</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">hello2</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Target process not found</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">pid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Got PID:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">pid</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">hostSession</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">persist-timeout</span><span class="dl">'</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Variant</span><span class="p">(</span><span class="dl">'</span><span class="s1">u</span><span class="dl">'</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
  <span class="p">});</span>
  <span class="err">…</span>
<span class="p">}</span></code></pre></figure>

<p>(Full example can be found in <a href="https://github.com/frida/frida-python/blob/bbdcdfaca821276361399775bd81599710ec0625/examples/web_client/src/store/plugins/frida.ts">examples/web_client</a>.)</p>

<p>This means that Frida’s network protocol is now WebSocket-based, so browsers can
finally talk directly to a running Portal/frida-server, without any middleware
or gateways in between.</p>

<p>I didn’t want this to be a half-baked story though, so I made sure that the
<a href="https://github.com/frida/frida-core/blob/0120cf59bc6f623bb842c93bc8870ce2a704453c/lib/base/p2p.vala">peer-to-peer implementation</a> is built on WebRTC data channels – this way
even browsers can communicate with minimal latency and help keep the AWS bill
low.</p>

<h3 id="part-ix-assets">Part IX: Assets</h3>

<p>Once we’ve built a web app to go with our Portal, which is speaking WebSocket
natively, and thus also HTTP, we can also make it super-easy to serve that SPA
from the same server:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>./frida-portal <span class="nt">--asset-root</span><span class="o">=</span>/path/to/web/app</code></pre></figure>

<p>This is also easy at the API level:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">control_params</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">EndpointParameters</span><span class="p">(</span><span class="n">asset_root</span><span class="o">=</span><span class="s">"/path/to/web/app"</span><span class="p">)</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">PortalService</span><span class="p">(</span><span class="n">cluster_params</span><span class="p">,</span> <span class="n">control_params</span><span class="p">)</span></code></pre></figure>

<h3 id="part-x-collaboration">Part X: Collaboration</h3>

<p>A natural next step once we have a controller, say a web app, is that we might
want collaboration features where multiple running instances of that SPA are
able to communicate with each other.</p>

<p>Given that we already have a TCP connection between the controller and the
PortalService, it’s practically free to also let the developer use that channel.
For many use-cases, needing an additional signaling channel brings a lot of
complexity that could be avoided.</p>

<p>This is where the new <code class="language-plaintext highlighter-rouge">Bus</code> API comes into play:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">frida</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># TODO: Handle incoming message.
</span>    <span class="k">pass</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">get_device_manager</span><span class="p">()</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">add_remote_device</span><span class="p">(</span><span class="s">"my.portal.com"</span><span class="p">)</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">bus</span>

<span class="n">bus</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="n">on_message</span><span class="p">)</span>
<span class="n">bus</span><span class="p">.</span><span class="n">attach</span><span class="p">()</span>

<span class="n">bus</span><span class="p">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">'type'</span><span class="p">:</span> <span class="s">'rename'</span><span class="p">,</span>
    <span class="s">'address'</span><span class="p">:</span> <span class="s">"0x1234"</span><span class="p">,</span>
    <span class="s">'name'</span><span class="p">:</span> <span class="s">"EncryptPacket"</span>
<span class="p">})</span>
<span class="n">bus</span><span class="p">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">'type'</span><span class="p">:</span> <span class="s">'chat'</span><span class="p">,</span>
    <span class="s">'text'</span><span class="p">:</span> <span class="s">"Hey, check out EncryptPacket everybody"</span>
<span class="p">})</span></code></pre></figure>

<p>Here we’re first attaching a message handler so we can receive messages from the
Portal.</p>

<p>Then we’re calling <code class="language-plaintext highlighter-rouge">attach()</code> so that the Portal knows we’re interested
in communicating with it. (We wouldn’t want it sending messages to controllers
that don’t make use of the Bus, such as frida-trace.)</p>

<p>Finally, we <code class="language-plaintext highlighter-rouge">post()</code> two different message types. It is up to the PortalService
to decide what to do with them.</p>

<p>So this means that the remote PortalService needs to be instantiated through the
API, as incoming messages need to be handled – the Portal won’t forward them to
other controllers on its own.</p>

<p>Worry not, though, this is easy:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">frida</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># TODO: Handle incoming message.
</span>    <span class="k">pass</span>

<span class="n">cluster_params</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">EndpointParameters</span><span class="p">()</span>
<span class="n">control_params</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">EndpointParameters</span><span class="p">()</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">frida</span><span class="p">.</span><span class="n">PortalService</span><span class="p">(</span><span class="n">cluster_params</span><span class="p">,</span> <span class="n">control_params</span><span class="p">)</span>
<span class="n">service</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="n">on_message</span><span class="p">)</span>
<span class="n">service</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">sys</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="n">read</span><span class="p">()</span></code></pre></figure>

<p>In <code class="language-plaintext highlighter-rouge">on_message()</code> it should look at the <code class="language-plaintext highlighter-rouge">message</code> and decide what to do.</p>

<p>It might choose to reply to the controller that sent it the message:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">service</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">'type'</span><span class="p">:</span> <span class="s">'rename-rejected'</span><span class="p">,</span>
    <span class="s">'reason'</span><span class="p">:</span> <span class="s">"Not authorized"</span>
<span class="p">})</span></code></pre></figure>

<p>Another useful thing to do is sending a welcome message whenever somebody
calls attach() on their Bus object:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">on_subscribe</span><span class="p">(</span><span class="n">connection_id</span><span class="p">):</span>
    <span class="n">service</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">'type'</span><span class="p">:</span> <span class="s">'welcome'</span><span class="p">,</span>
        <span class="s">'users'</span><span class="p">:</span> <span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="n">nick</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">connected_users</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">service</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'subscribe'</span><span class="p">,</span> <span class="n">on_subscribe</span><span class="p">)</span></code></pre></figure>

<p>Depending on your application, you might also need a way to broadcast a message
to all controllers who are attached to their Bus:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">service</span><span class="p">.</span><span class="n">broadcast</span><span class="p">({</span>
    <span class="s">'type'</span><span class="p">:</span> <span class="s">'announce'</span><span class="p">,</span>
    <span class="s">'text'</span><span class="p">:</span> <span class="s">"Important Service Announcement"</span>
<span class="p">})</span></code></pre></figure>

<p>You can also <code class="language-plaintext highlighter-rouge">narrowcast()</code> a message to a subset of controllers:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">service</span><span class="p">.</span><span class="n">narrowcast</span><span class="p">(</span><span class="s">"#reversing"</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">'type'</span><span class="p">:</span> <span class="s">'chat'</span><span class="p">,</span>
    <span class="s">'sender'</span><span class="p">:</span> <span class="n">user</span><span class="p">.</span><span class="n">nick</span><span class="p">,</span>
    <span class="s">'text'</span><span class="p">:</span> <span class="s">"Hello everyone"</span>
<span class="p">})</span></code></pre></figure>

<p>This means any controller connection tagged with <code class="language-plaintext highlighter-rouge">#reversing</code> will receive that
message. Tagging is done like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">service</span><span class="p">.</span><span class="n">tag</span><span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="s">"#reversing"</span><span class="p">)</span></code></pre></figure>

<p>Such tags could then be added based on actions, like a controller sending a
“join” message to join a channel. They could also be applied based on
authentication, so that only connections belonging to a certain GitHub
organization receive that message – just as an example.</p>

<p>Lastly, on the cluster side, it is also possible to specify an Access Control
List (ACL) when joining the Portal. The ACL is an array of strings that specify
tags which will grant controllers access to discover and interact with the given
process. This means that <code class="language-plaintext highlighter-rouge">service.tag()</code> needs to be used for each controller
that should be granted access to a certain node/group of nodes.</p>

<p>That is pretty much all there is to it. For a more comprehensive example, check
out <a href="https://github.com/frida/frida-python/blob/bbdcdfaca821276361399775bd81599710ec0625/examples/portal_server.py">examples/portal_server.py</a> and <a href="https://github.com/frida/frida-python/blob/bbdcdfaca821276361399775bd81599710ec0625/examples/portal_client.py">examples/portal_client.py</a>, which
implement an IRC-esque chat service.</p>

<h2 id="system-parameters">System Parameters</h2>

<p>Back in May I had a chat with <a href="https://twitter.com/Hexploitable">@Hexploitable</a>, who was working on a tool
where he needed to pick a Device object based on whether it’s running iOS vs
Android. This is a feature that’s been requested in the past, and it felt like
it might be time to finally address it.</p>

<p>While one could do device.attach(0) and load a script in the system session, in
order to run code inside Frida itself (e.g. in a remote frida-server), it is
somewhat tedious. It also doesn’t work if the Device represents a
jailed/non-rooted device, where code execution is a lot more constrained.</p>

<p>So after brainstorming this a bit, @Hexploitable started working on implementing
it, and quickly got to the point where he had the first draft working. This was
later refined by me, and got merged shortly after the Portals feature had
finally landed.</p>

<p>The API is simple, and easy to extend in the future:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'import frida; import json; \
    print(json.dumps(frida.query_system_parameters()))'</span> <span class="se">\</span>
    | jq</code></pre></figure>

<p><img src="../../../../../img/query-system-parameters-macos.png" alt="macOS Device" title="Output for a macOS Device" /></p>

<p>And if I attach a jailed iOS device, I can also query it:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'import frida; import json; \
    device = frida.get_usb_device(); \
    print(json.dumps(device.query_system_parameters()))'</span> <span class="se">\</span>
    | jq</code></pre></figure>

<p><img src="../../../../../img/query-system-parameters-ios.png" alt="iOS Device" title="Output for an iOS Device" /></p>

<p>An important detail to note here is <code class="language-plaintext highlighter-rouge">access: 'jailed'</code>. This is how you can
determine whether you’re accessing the device through our support for jailed
iOS/Android systems, i.e. limited to debuggable apps, or actually talking to
a remote frida-server – which is what <code class="language-plaintext highlighter-rouge">access: 'full'</code> means.</p>

<p>Things are not quite as juicy for Android yet (PRs welcome, btw!), but there are
still plenty of useful details:</p>

<p><img src="../../../../../img/query-system-parameters-android.png" alt="Android Device" title="Output for an Android Device" /></p>

<p>We’re also able to identify the specific Linux distro if it’s LSB-compliant:</p>

<p><img src="../../../../../img/query-system-parameters-ubuntu.png" alt="Ubuntu Device" title="Output for an Ubuntu Device" /></p>

<p>And last but not least, Windows:</p>

<p><img src="../../../../../img/query-system-parameters-windows.png" alt="Windows Device" title="Output for a Windows Device" /></p>

<h2 id="application-and-process-parameters">Application and Process Parameters</h2>

<p>Another cool idea that started taking shape after some impromptu chats, was when
<a href="https://twitter.com/trufae">@pancake</a> told me it would be useful to know the particular version of an
installed iOS app.</p>

<p>As I had just broken the protocol in so many ways working on the Portals
feature, it also seemed like a great time to break it some more, and avoid
another painful major bump down the road.</p>

<p>Fast forward a bit, and here’s how it turned out: Our <code class="language-plaintext highlighter-rouge">Application</code> and
<code class="language-plaintext highlighter-rouge">Process</code> objects no longer have any <code class="language-plaintext highlighter-rouge">small_icon</code> or <code class="language-plaintext highlighter-rouge">large_icon</code> properties,
but they now have a <code class="language-plaintext highlighter-rouge">parameters</code> dict.</p>

<p>By default, with <code class="language-plaintext highlighter-rouge">enumerate_applications()</code>, things look familiar:</p>

<p><img src="../../../../../img/enumerate-applications-ios-minimal.png" alt="enumerate_applications()" title="enumerate_applications()" /></p>

<p>But by changing that to <code class="language-plaintext highlighter-rouge">enumerate_applications(scope='metadata')</code>, things get a
lot more interesting:</p>

<p><img src="../../../../../img/enumerate-applications-ios-metadata.png" alt="enumerate_applications(scope='metadata')" title="enumerate_applications(scope='metadata')" /></p>

<p>Here we can see the iOS Twitter app’s version and build number, where its app
bundle is on the filesystem, the containers that it owns, that it is currently
the frontmost app, how long ago it was started, etc.</p>

<p>We can also crank that up to <code class="language-plaintext highlighter-rouge">enumerate_applications(scope='full')</code> and get
icons as well:</p>

<p><img src="../../../../../img/enumerate-applications-ios-full.png" alt="enumerate_applications(scope='full')" title="enumerate_applications(scope='full')" /></p>

<p>The <code class="language-plaintext highlighter-rouge">debuggable: true</code> parameter is very useful if query_system_parameters()
reported <code class="language-plaintext highlighter-rouge">access: 'jailed'</code>, as that means your application may want to filter
the list of apps to only show the ones it is able to spawn() and/or attach() to,
or perhaps show debuggable apps more prominently to provide a better UX.</p>

<p>It’s probably also worth mentioning that <code class="language-plaintext highlighter-rouge">get_frontmost_application()</code> now
supports passing a <code class="language-plaintext highlighter-rouge">scope</code> as well.</p>

<p>Those of you familiar with the old API may have noticed that icons may now be
delivered in compressed form, as PNGs. Previously this was always uncompressed
RGBA data, and the iOS side would do the PNG decoding and downscaling to two
fixed resolutions (16x16 and 32x32).</p>

<p>All of this meant that we would waste a lot of CPU time, memory and bandwidth to
include icons, even if all of that data would end up in a CLI tool that doesn’t
make use of it. So now with Frida 15 you might notice that application and
process listing is a lot faster. And even if you do request icons, it should
also be faster than before as we don’t do any decompression and downscaling.</p>

<p>That was application listing. All of the above is also true for process listing,
and this is what <code class="language-plaintext highlighter-rouge">enumerate_applications(scope='full')</code> might look like now:</p>

<p><img src="../../../../../img/enumerate-processes-ios-full.png" alt="enumerate_processes(scope='full')" title="enumerate_processes(scope='full')" /></p>

<p>Here it is also clear that the Twitter app is currently frontmost, that its
parent PID is launchd (PID 1), the user it is running as, when it was started,
etc.</p>

<p>You might be wondering why <code class="language-plaintext highlighter-rouge">applications</code> is an array though, and the answer is
probably best illustrated by an example from Android:</p>

<p><img src="../../../../../img/enumerate-processes-android-full.png" alt="enumerate_processes(scope='full')" title="enumerate_processes(scope='full')" /></p>

<p>The “com.android.phone” process actually hosts six different “applications”!</p>

<p>And once again, last but not least, I didn’t forget about Windows:</p>

<p><img src="../../../../../img/enumerate-processes-windows-full.png" alt="enumerate_processes(scope='full')" title="enumerate_processes(scope='full')" /></p>

<p>So that’s the “scope” option. There’s also another one, meant for UIs. The idea
is that a UI might want to grab the list of applications/processes quickly, and
may not actually need metadata/icons until the user interacts with a particular
entry, or scrolls a subset of entries into view. So we now provide an option to
support such use-cases.</p>

<p>Say we only want to grab the metadata for two specific apps, we can now do:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"com.atebits.Tweetie2"</span><span class="p">,</span>
    <span class="s">"no.sparebank1.mobilbank"</span>
<span class="p">]</span>
<span class="n">apps</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">enumerate_applications</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
                                     <span class="n">scope</span><span class="o">=</span><span class="s">'full'</span><span class="p">)</span></code></pre></figure>

<p><img src="../../../../../img/enumerate-selected-applications.png" alt="enumerate_applications(identifiers=x)" title="enumerate_applications(identifiers=x)" /></p>

<p>We also support the same feature for process listing, where it looks like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">processes</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">enumerate_processes</span><span class="p">(</span><span class="n">pids</span><span class="o">=</span><span class="p">[</span><span class="mi">1337</span><span class="p">,</span> <span class="mi">1338</span><span class="p">],</span>
                                       <span class="n">scope</span><span class="o">=</span><span class="s">'full'</span><span class="p">)</span></code></pre></figure>

<h2 id="portals-and-applicationprocess-parameters">Portals and Application/Process Parameters</h2>

<p>Now that we have covered application parameters <strong>and</strong> portals, there’s an
important detail that’s worth mentioning: Given that it doesn’t make much sense
to implement query_system_parameters() in the case of a PortalService, as it’s
surfacing processes from any number of (potentially remote) systems, we can use
application/process parameters to fill this void.</p>

<p>This means that any Application and Process coming from a PortalService will,
if <code class="language-plaintext highlighter-rouge">scope</code> is set to <code class="language-plaintext highlighter-rouge">metadata</code> or <code class="language-plaintext highlighter-rouge">full</code>, provide one parameter named <code class="language-plaintext highlighter-rouge">system</code>,
which contains the system parameters for that particular application/process.
This way an application can still know ahead of time if it’s interested in a
particular process.</p>

<h2 id="jailed-ios-and-android-improvements">Jailed iOS and Android Improvements</h2>

<p>I had a lot of fun implementing the Application and Process parameters feature,
and tried to see how narrow I could make the gap between jailed (non-rooted) and
jailbroken (rooted). For example on Android, we didn’t even fetch app labels in
the non-rooted code-path. This was because we were relying on running shell
commands over ADB, and I couldn’t find a way to grab labels in that case.</p>

<p>The shell command route is very fragile, as most tools output details in a
format that’s meant to be consumed by a human, not a machine. And obviously
such output is likely to change as Android evolves.</p>

<p>Because of this we now have a tiny prebuilt .dex that we copy over and run, and
grabbing metadata is only a matter of making RPC calls to that helper process.
This means we are able to provide all the same details for non-rooted as we
provide in the rooted case, where we have a frida-server running on the Android
side.</p>

<p>Another thing worth mentioning is that we no longer consider Android’s launcher
a frontmost app, which means this is now consistent with our behavior on iOS,
where SpringBoard is never considered the frontmost app.</p>

<p>As part of these major changes I also added code to fetch icons on Android as
well, both non-rooted and rooted, so that this feature is no longer just limited
to iOS, macOS, and Windows.</p>

<p>We didn’t provide icons for jailed iOS though, but that feature gap is now also
closed. There is however still one difference between jailed and jailbroken iOS:
the <code class="language-plaintext highlighter-rouge">ppid</code> and <code class="language-plaintext highlighter-rouge">user</code> parameters are not available in the jailed case, as this
is not exposed by any lockdown/DTX API that I’m currently aware of. But other
than that, things are in pretty good shape.</p>

<h2 id="massively-improved-backtraces-on-imacos">Massively improved backtraces on i/macOS</h2>

<p>Thanks to a very exciting pull-request by <a href="https://github.com/hot3eed">@hot3eed</a>, we now have an i/macOS
symbolication fallback that uses the Objective-C runtime. In this way, instead
of showing <code class="language-plaintext highlighter-rouge">module!0x1234</code>, we may be able to resolve that to an Objective-C
method. Yay!</p>

<p>We also got another awesome contribution by <a href="https://twitter.com/bezjaje">@mrmacete</a>, where NativeCallback
now always exposes a context, so you can do <code class="language-plaintext highlighter-rouge">Thread.backtrace(this.context)</code> and
expect it to work in all cases.</p>

<p>This was previously only possible when NativeCallback was used as an Interceptor
replacement. So if you were using ObjC.implement() to swizzle an Objective-C
API, you couldn’t actually capture a backtrace from that NativeCallback. So this
is a super-exciting improvement!</p>

<h2 id="unextracted-native-libraries-on-android">Unextracted Native Libraries on Android</h2>

<p>For those of you using Frida on Android, you may have encountered apps where
native libraries don’t reside on the filesystem, but are loaded directly from
the app’s .apk. Thanks to a great contribution by <a href="https://github.com/P-Sc">@P-Sc</a>, we now support this
transparently – no changes needed in your existing instrumentation code.</p>

<h2 id="upgraded-os-support">Upgraded OS Support</h2>

<p>We now also support the latest betas of macOS Monterey, iOS 15, and Android 12.
Special thanks to <a href="https://github.com/alexhude">@alexhude</a> at <a href="https://corellium.com/">Corellium</a> for helping debug and test
things on iOS 15, and <a href="https://github.com/pengzhangdev">@pengzhangdev</a> who contributed a fix for
frida-java-bridge to support Android 12.</p>

<h2 id="networked-ios-devices">Networked iOS Devices</h2>

<p>Another feature that’s been requested a few times is support for networked iOS
devices. This is great if you don’t want to destroy your iPhone/iPad’s battery
by leaving it plugged in all day. What’s great about this feature is that it
“just works” – you should see them if you run <code class="language-plaintext highlighter-rouge">frida-ls-devices</code>.</p>

<p>Only two pitfalls worth mentioning: You may now have two different Device
objects with the same ID, in case a networked iOS device is reachable through
the network while also being plugged in.</p>

<p>E.g.:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>frida-ls-devices
Id                         Type    Name
<span class="nt">-------------------------</span>  <span class="nt">------</span>  <span class="nt">-------------------------------------</span>
<span class="nb">local                      local   </span>Local System
00008027-xxxxxxxxxxxxxxxx  usb     iPad
socket                     remote  Local Socket
00008027-xxxxxxxxxxxxxxxx  remote  iOS Device <span class="o">[</span>fe80::146f:75af:d79:630c]</code></pre></figure>

<p>So if you’re using <code class="language-plaintext highlighter-rouge">-U</code> or <code class="language-plaintext highlighter-rouge">frida.get_usb_device()</code> things will work just like
before, where you’ll be using your device through USB. But if you want to use
the networked device, then resolving it by ID means the USB entry will take
precedence, as it’s typically ahead of the networked device in the list of
devices.</p>

<p>This means you would also need to check its <code class="language-plaintext highlighter-rouge">type</code>. Our CLI tools don’t
yet provide a switch to do this, but this would be a welcome pull-request if
anyone’s interested!</p>

<p>The second pitfall is that frida-server only listens on the loopback interface
by default, meaning we won’t be able to connect to it over the network. So if
you’re using our iOS .deb either manually or through Cydia, you will have to
edit <code class="language-plaintext highlighter-rouge">/Library/LaunchDaemons/re.frida.server.plist</code> to add the <code class="language-plaintext highlighter-rouge">--listen</code>
switch, and then use <code class="language-plaintext highlighter-rouge">launchctl</code> to restart it.</p>

<p>This may also be a situation where you want to make use of the new TLS and
authentication features mentioned earlier, depending on how much you trust your
network environment.</p>

<h2 id="eof">EOF</h2>

<p>There’s also a bunch of other exciting changes, so definitely check out the
changelog below.</p>

<p>Enjoy!</p>

<h3 id="changes-in-1500">Changes in 15.0.0</h3>

<ul>
  <li>Introduce PortalService API and daemon, a network service that
orchestrates a cluster of remote processes instrumented by Frida.
Implements both a frida-server compatible control interface, as well
as a cluster interface that agents and gadgets in target processes can
talk to. Connected controllers can enumerate processes as if they were
local to the system where the portal is running, and are able to
attach() and also enable spawn-gating to apply early instrumentation.</li>
  <li>Add Session.join_portal(), making it easy to share control of a
process with a remote PortalService, joining its cluster together with
other nodes.</li>
  <li>Add “connect” interaction to frida-gadget, so it can join a
PortalService cluster as well.</li>
  <li>Add PortalClient, used to implement Session.join_portal() and
frida-gadget’s “connect” interaction. Connects to the PortalService
and joins its cluster. Implements automatic reconnect in case of
transient failures. Also supports specifying an ACL, which is a list
of tags that the PortalService must require connected controllers to
possess at least one of. It’s up to the application to implement
tagging of controllers based on e.g. authentication.</li>
  <li>Add Device.bus API to allow clients connected to a PortalService to
exchange application-specific messages with it. Requires instantiating
the service using the API in order to wire up message handlers and
protocol logic.</li>
  <li>Add Session persistence support, enabled by specifying a non-zero
“persist_timeout” option when attach()ing to a process. When the
server subsequently detects that the client owning the session got
disconnected, it will allow scripts to stay loaded until the timeout
(in seconds) is reached. Any script and debugger messages emitted in
the meantime are queued, and may later be delivered if the client
returns before the timeout is reached.</li>
  <li>Add TLS support, enabled by specifying a certificate. On the server
end this is a PEM with a public and private key, where the server
will accept any certificate from the client’s side. However for the
client this is a PEM with the public key of a trusted CA, which the
server’s certificate must match or be derived from.</li>
  <li>Add authentication support, enabled by specifying a token. The daemons
allow specifying a static token through a CLI option, and the APIs
allow plugging in a custom authentication backend – which means the
token can be interpreted as desired.</li>
  <li>Move network protocols to WebSocket.</li>
  <li>Add protocol-level keepalives.</li>
  <li>Implement WebRTC Data Channel compatible peer-to-peer support, enabled
by calling setup_peer_connection() on Session. This allows a direct
connection to be established between the client and the remote
process, which is useful when talking to it through e.g. a Portal.</li>
  <li>Optimize protocol by skipping the DBus authentication handshake and
telling GDBus not to fetch properties, saving an additional roundtrip.</li>
  <li>Drop deprecated protocol bits, such as Session.enable_jit().</li>
  <li>Add Device.query_system_parameters(). Thanks <a href="https://twitter.com/Hexploitable">@Hexploitable</a>!</li>
  <li>Improve the application and process query APIs. (Covered extensively above.)</li>
  <li>Switch Crash parameter names to kebab-case.</li>
  <li>Add Session.is_detached(), useful in multi-threaded scenarios where the
“detached” signal may already have been emitted by the time we manage to
connect to it.</li>
  <li>Fix Stalker handling of SYSCALL instructions on Linux/x86.</li>
  <li>Fix the iPad device name on macOS.</li>
  <li>Massively improve backtraces/symbolication on i/macOS in cases where symbols
are missing, but the address to be symbolicated belongs to an Objective-C
method. Thanks <a href="https://github.com/hot3eed">@hot3eed</a>!</li>
  <li>Improve backtracer accuracy and flexibility, now exposing a minimal context to
NativeCallback in cases where it’s not used as an Interceptor replacement. One
such example is ObjC.implement(), used for swizzling APIs. Thanks
<a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Improve Interceptor reliability on macOS/arm64, by switching to the mapping
strategy that we use on iOS.</li>
  <li>Add support for network-connected iOS devices.</li>
  <li>Avoid leaving behind a file when sandbox check fails on iOS.</li>
  <li>Fix Stalker on newer iOS hardware jailbroken with checkra1n. This was solved
by disabling RWX support on iOS for now: Even if the jailbreak appears to make
it available, whether it actually works boils down to which mitigations the
hardware supports. Shout-out to <a href="https://twitter.com/ghidraninja">@stacksmashing</a> for reporting and helping
get to the bottom of this one!</li>
  <li>Remove bashisms from iOS maintainer scripts, for improved jailbreak
compatibility. Thanks <a href="https://github.com/nyuszika7h">@nyuszika7h</a>!</li>
  <li>Improve Interceptor frame layout on arm64, so backtracing code is able to walk
the stack past our generated code. This also makes it easier to use a debugger
together with Interceptor.</li>
  <li>Fix ObjC ApiResolver deadlock, which occurred when free() was resolved lazily
from a dyld image callback, at which point it is a bad idea to call dlsym().</li>
  <li>Add support for unextracted native libraries on Android. Thanks <a href="https://github.com/P-Sc">@P-Sc</a>!</li>
  <li>Fix Android get_frontmost_application() name truncation.</li>
  <li>Don’t consider the Android launcher a frontmost app.</li>
  <li>Use the Android app’s label as the process name if the process represents is
its main UI process. This is finally consistent with what we do on iOS.</li>
  <li>Improve jailed Android injector: Now using a long-lived shell session to speed
things up. Also ensure filenames dropped into /data/local/tmp are unique, and
clean up temporary files.</li>
  <li>Drop Firefox OS support.</li>
  <li>Rename the weak ref API to avoid clashing with ES2021. So instead of
WeakRef.bind() and WeakRef.unbind(), these are now Script.bindWeak() and
Script.unbindWeak().</li>
  <li>Massively improve memory allocation performance on Windows, by lowering the
dlmalloc spin-lock sleep duration to zero – which means it will only yield
the remainder of its time slice. The default of 50 ms is prone to introduce
significant delay as soon as threads start competing for the lock.</li>
  <li>Lazily create the ScriptScheduler thread pool. This means anyone using GumJS
can avoid background threads until they’re really needed. Very useful if
you’re writing a tool or agent that needs to handle fork(), without having to
implement logic to stop and later restart threads. (Something frida-agent
does, but which isn’t necessarily needed for simple use-cases.)</li>
  <li>Java: Add support for Android 12 beta. Thanks <a href="https://github.com/pengzhangdev">@pengzhangdev</a>!</li>
  <li>Java: Fix Java.array() for unloaded array types: If the type of the array was
not used in the application it means that it wasn’t loaded into memory, and
Java.array() previously failed because of this. Thanks <a href="https://github.com/yotamN">@yotamN</a>!</li>
  <li>Java: Add toString() to primitive arrays, so that instead of the generic
“[Object Object]” string it will generate a string where the array values are
separated by commas. Thanks <a href="https://github.com/yotamN">@yotamN</a>!</li>
  <li>CModule: Add missing TinyCC builtins for 32-bit x86.</li>
  <li>python: Add Script.is_destroyed property.</li>
  <li>python: Add Session.is_detached property.</li>
  <li>python: Add Device.is_lost property.</li>
  <li>python: Throw when attempting an RPC call on a destroyed script.</li>
  <li>node: Fix compatibility with newer versions of Node.js, where any given
Buffer’s backing store needs to be unique. We solve this by simply making a
copy in cases where we cannot guarantee that the same buffer can only be
observed once.</li>
  <li>node: Fix use-after-free in signal transform callbacks.</li>
  <li>node: Fix use-after-free in signal connection callbacks.</li>
  <li>node: Move to C++17, for compatibility with newer Node.js headers.</li>
  <li>node: Add Script.isDestroyed property.</li>
  <li>node: Add Device.isLost property.</li>
</ul>

<h3 id="changes-in-1501">Changes in 15.0.1</h3>

<ul>
  <li>Ensure DarwinGrafter’s merging of binds doesn’t make gaps in __LINKEDIT.
Not doing so triggers a bug in <code class="language-plaintext highlighter-rouge">codesign</code> for which the resulting signed
binary turns out corrupted. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>node: Fix compilation error when building with MSVC.</li>
</ul>

<h3 id="changes-in-1502">Changes in 15.0.2</h3>

<ul>
  <li>Fix handling of large messages, for both client-server and p2p. Also bump the
WebSocket payload size limit to 256 KiB - same as is typically negotiated for
data channels in p2p mode.</li>
  <li>Move WebSocket I/O to the DBus thread, to avoid unnecessary thread hopping.</li>
  <li>Plug leaks when using p2p.</li>
</ul>

<h3 id="changes-in-1503">Changes in 15.0.3</h3>

<ul>
  <li>Implement a new frida-pipe strategy for i/macOS. Turns out that our previous
strategy of directly setting up a Mach port in the target process becomes
problematic with guarded Mach ports. So instead we register a Mach service
that’s globally visible, and have the target process contact it to fetch its
end of the socketpair. We also check with the sandbox up front, and issue an
extension token if needed. However, if we’re unable to register the Mach
service with launchd, we fall back to our previous strategy.</li>
  <li>Skip iOS platformized detection on iOS &gt;= 15. It interacts badly with guarded
Mach ports.</li>
  <li>Port early instrumentation to macOS 12 and iOS 15.</li>
  <li>Gracefully handle agent failing to start. Instead of crashing the target
process, simply log the error and unload.</li>
  <li>Linux: Use an abstract name for frida-pipe when supported.</li>
  <li>Unlink UNIX socket when frida-pipe is done with it.</li>
  <li>Fix iOS policyd Mach message lifetime logic.</li>
</ul>

<h3 id="changes-in-1504">Changes in 15.0.4</h3>

<ul>
  <li>Fix the i/macOS injector’s data size logic. It’s been hard-coded since the
beginning, and the recent entrypoint data size adjustment broke it on systems
with 4K pages.</li>
  <li>Fix i/macOS early instrumentation regression on dyld &lt; 4.</li>
</ul>

<h3 id="changes-in-1505">Changes in 15.0.5</h3>

<ul>
  <li>Fix the __CFInitialize() code-path on dyld &gt;= 4.</li>
  <li>Fix i/macOS sandbox extension logic during spawn().</li>
  <li>Port jailed iOS injector to iOS 15.</li>
  <li>Implement Android USAP interop.</li>
  <li>Improve DarwinGrafter lazy binds merge logic. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
</ul>

<h3 id="changes-in-1506">Changes in 15.0.6</h3>

<ul>
  <li>Fix Windows build regression.</li>
</ul>

<h3 id="changes-in-1507">Changes in 15.0.7</h3>

<ul>
  <li>Fix early instrumentation on Android 12.</li>
  <li>node: Fix the ApplicationParameters typings. Thanks for reporting,
<a href="https://twitter.com/trufae">@pancake</a>!</li>
</ul>

<h3 id="changes-in-1508">Changes in 15.0.8</h3>

<ul>
  <li>iOS: Add support for unc0ver v6.1.2.</li>
  <li>iOS: Update Substrate interop logic to support 0.9.7113.</li>
</ul>

<h3 id="changes-in-1509">Changes in 15.0.9</h3>

<ul>
  <li>iOS: Revive support for older OS versions. (Verified on iOS 10.3.)</li>
  <li>iOS: Fix support for older Apple usbmuxd versions.</li>
  <li>Android: Handle devices where jailed is unsupported.</li>
  <li>Fix DarwinGrafter alignment issue, aligning to 16 bytes also when lazy
binds follow regular binds. Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
</ul>

<h3 id="changes-in-15010">Changes in 15.0.10</h3>

<ul>
  <li>Fix regression where Device.open_channel(“lockdown:”) ended up closing the
stream right away.</li>
  <li>Fix crash when talking to older versions of ADB.</li>
</ul>

<h3 id="changes-in-15011">Changes in 15.0.11</h3>

<ul>
  <li>Rewrite macOS spawn gating to use DTrace. This means we’ve now dropped support
for our kernel extension, and we don’t need to worry about future OSes no
longer supporting extensions. It also means we finally support spawn gating on
Apple Silicon as well.</li>
  <li>Work around i/macOS arm64 single-step delay during early instrumentation.</li>
</ul>

<h3 id="changes-in-15012">Changes in 15.0.12</h3>

<ul>
  <li>Fix macOS spawn gating task port lifetime issue. Should not try to be clever
and keep task ports around – bad things happen if a task port is used after an
exec transition.</li>
  <li>Remove the i/macOS task port caching logic. It is dangerous in exec
transitions, adds some complexity, and doesn’t help all that much
performance-wise, anyway.</li>
  <li>Make the macOS spawn gating DTrace predicate environment variable optional.</li>
  <li>Improve the macOS spawn gating error message.</li>
</ul>

<h3 id="changes-in-15013">Changes in 15.0.13</h3>

<ul>
  <li>Improve clients to specify Host header and use TLS SNI.</li>
  <li>Revert i/macOS single-step delay workarounds.</li>
  <li>iOS: Fix usbmux port number encoding in the connect request.</li>
  <li>Python, Node.js: Fix ownership in Device.spawn() aux options logic.</li>
</ul>

<h3 id="changes-in-15014">Changes in 15.0.14</h3>

<ul>
  <li>Port iOS crash reporter integration to iOS 14.7.1.</li>
  <li>Configure internal agents to be less intrusive on i/macOS.</li>
  <li>Improve i/macOS error-handling during process preparation.</li>
  <li>Revive i/macOS single-step delay workarounds, which turned out to be needed
after all.</li>
  <li>Handle reentrancy when about to yield JS lock, which may happen if a replaced
function gets called by Interceptor during end_transaction().</li>
  <li>Fix conditional Interceptor unignore logic in GumJS. This was preventing
Interceptor from ignoring internal calls, and resulted in noise and reduced
performance.</li>
  <li>Enhance the i/macOS DebugSymbol fallback name to also include the unslid
address. This makes it easy to plop it into a static analysis tool.</li>
  <li>Fix Stalker code slab refill logic.</li>
  <li>Add Stalker stats interface.</li>
</ul>

<h3 id="changes-in-15015">Changes in 15.0.15</h3>

<ul>
  <li>Rework i/macOS Exceptor to support latest iOS 14. This would previously result
in a deadlock whenever a native exception occurred.</li>
</ul>

<h3 id="changes-in-15016">Changes in 15.0.16</h3>

<ul>
  <li>Fix i/macOS single-step handling on ARM during early instrumentation, which
would result in attach() failing randomly for a freshly spawn()ed process.
Thanks <a href="https://twitter.com/bezjaje">@mrmacete</a>!</li>
  <li>Add Stalker backpatch prefetching support.</li>
  <li>Make Stalker inline cache size configurable on x86.</li>
  <li>Optimize Stalker x86 return handling.</li>
  <li>ObjC: Allow proxies to implement methods. Thanks <a href="https://github.com/hot3eed">@hot3eed</a>!</li>
</ul>

<h3 id="changes-in-15017">Changes in 15.0.17</h3>

<ul>
  <li>gadget: Support packaging as framework on i/macOS. Load config from
“Resources/config.json”, and resolve relative paths relative to the same
directory. As an added bonus, we now also support specifying relative paths
for “certificate” and “asset_root”.</li>
  <li>web-service: Implement basic directory listing with NGINX-style output. This
is useful with e.g. “frida-server –asset-root=/”.</li>
  <li>stalker: Fix backpatch args for 32-bit x86.</li>
</ul>

<h3 id="changes-in-15018">Changes in 15.0.18</h3>

<ul>
  <li>Plug long-standing memory leaks, both in our internal heap’s realloc behavior
being misconfigured and causing leaks, and in how we register JavaScript
classes with QuickJS. Kudos to <a href="https://twitter.com/bezjaje">@mrmacete</a> for discovering and helping track
down these long-standing bugs!</li>
</ul>

<h3 id="changes-in-15019">Changes in 15.0.19</h3>

<ul>
  <li>gadget: Fix framework resource lookup logic on iOS.</li>
</ul>


  </p>
</article>

      </div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit whole align-right center-on-mobiles">
      <div class="sponsored-by">
        <h5>Sponsored by:</h5>
        <a href="https://www.nowsecure.com">
          <img src="../../../../../img/nowsecure-logo.png" alt="NowSecure">
        </a>
      </div>
    </div>
  </div>
</footer>

  


  <!-- Google Analytics (http://google.com/analytics) -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46880695-1']);
    _gaq.push(['_setDomainName', 'https://frida.re']); // Multiple sub-domains
    _gaq.push(['_setAllowLinker', true]); // Multiple TLDs
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
